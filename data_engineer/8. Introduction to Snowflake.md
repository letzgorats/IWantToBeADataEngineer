## Snowflake : 클라우드 기반 데이터 웨어하우스
- Snowflake는 **클라우드 기반 데이터 웨어하우스** 로, **컬럼형(Columnar) 데이터 저장 방식** 을 활용하여 고성능 데이터 분석을 가능하게 한다.
- AWS, Google Cloud, Microsoft Azure 등 다양한 클라우드 제공업체와 통합이 가능하며, **확장성** 과 **비용 효율성** 이 뛰어나다.

## 1. Snowflake
- Snowflake는 **클라우드에서 운영되는 데이터 웨어하우스** 이다.
- **컬럼형(Columnar) 데이터 저장 방식** 을 사용하여 분석 성능을 최적화한다.
- 클라우드 기반으로 유지보수를 부담 없이 확장할 수 있다.

- 핵심 특징
    - 완전한 **클라우드 네이티브(Cloud-Native)** 솔루션 이다.
    - 자동확장(Auto Scailing) 및 고성능 쿼리 처리가 가능하다.(컬럼 저장 방식 활용하므로)
    - **서버리스(Serverless)구조** (클라우드) 로 유지보수 부담이 없다.
    - **멀티 클라우드를 지원** 한다. (AWS, GCP, Azure 와 통합 가능)
    - **데이터 공유 기능(Data Sharing)** 을 지원한다.
    
## 2. 클라우드 데이터 웨어하우스의 개념 

- 클라우드 데이터웨어하우스의 장점
    - 하드웨어 구매 불필요 -> 초기 비용이 절감된다.
    - 사용량 기반 과금(Pay-as-you-go) -> 비용을 최적화할 수 있다.
    - 글로벌 접근성 -> 여러 지역에서 동시 데이터 사용이 가능하다.
    - 자동 확장(Auto Scailing) -> 데이터 증가에 유연한 대응이 가능하다.

- Snowflake 는 이러한 클라우드 데이터 웨어하우스의 강점을 극대화한 솔루션이다.

## 3. Row vs Columnar 데이터 저장 방식

- Snowflake 는 Columnar 데이터 저장 방식을 사용한다.
- 전통적인 데이터베이스(ex.PostgreSQL)는 행 기반(Row-Oriented) 저장 방식을 사용한다.

### Row-Oriented Storgae (행 기반 저장)
![Image](https://github.com/user-attachments/assets/ea9dd5ec-7afa-4050-a662-5635ba82967a)
![Image](https://github.com/user-attachments/assets/8b70564a-f0d3-429a-b96d-8739f6b518a9)

- 데이터를 행(Row) 단위로 저장
- **트랜잭션(OLTP)** 작업에 최적화(ex. 주문처리, CRUD 작업)
  
- 장점
    - 빠른 개별 레코드 조회가 가능하다.
    - 삽입 및 수정 작업에 최적화 되어있다.
- 단점
    - 특정 컬럼만 조회하는 분석 쿼리가 비효율적이다. (불필요한 데이터도 함께 로드된다.)

### Columnar Storage(열 기반 저장)
![Image](https://github.com/user-attachments/assets/ea9dd5ec-7afa-4050-a662-5635ba82967a)
![Image](https://github.com/user-attachments/assets/8e0b1810-ab27-4f39-bef3-6854679fa668)

- 데이터를 컬럼(Column) 단위로 저장
- **데이터 분석(OLAP)** 작업에 최적화(ex. 매출평균 계산)
  
- 장점
    - 특정 컬럼만 조회가 가능하다. -> 분석 성능이 향상된다.
    - 데이터 압축 효율이 증가한다. -> 저장 공간이 절약된다.
- 단점
    - 트랜잭션 작업이 상대적으로 느리다.

- Snowflake 는 컬럼 저장 방식을 활용하여 분석 성능을 극대화한다.

### Row vs Column DB 비교
![Image](https://github.com/user-attachments/assets/3faa47e2-3741-4426-b3b1-0cf4a26c3266)

## 4. Snowflake 의 주요 활용 사례
- Business Intelligence
- Data Science 
- Data Ingestion : 다양한 data source에서 데이터를 스트리밍, 배치 등의 방식으로 추출하여 data warehouse로 적재하는 것을 의미
- Data Warehousing
- Data Sharing

<hr>

## Snowflake 아키텍처 : 클라우드 데이터 웨어하우스의 구조 분석
- Snowflake 는 **스토리지(Storage)** 와 **컴퓨팅(Computing)** 을 **분리** 하는 아키텍처를 채택하여 확장성과 성능을 극대화한 **클라우드 기반 데이터 웨어하우스** 이다.

## Snowflake 의 아키텍처 개요
- Snowflake는 하이브리드 아키텍처를 사용한다.
- 스토리지(Shared-Disk) 와 컴퓨팅(Shared-Nothing) 을 분리하여 독립적인 확장이 가능하다.
- 3가지 주요 레이어로 구성된다.
    - 스토리지(Storage) 레이어 : 데이터를 **컬럼 기반으로 저장하고 최적화** 한다.
    - 컴퓨팅(Computing) 레이어 : 쿼리를 실행하는 **가상 웨어하우스(Virtual Warehouse)**
    - **클라우드 서비스(Cloud Services)** 레이어 : 보안, 관리, 메타데이터 처리

### 기존 데이터베이스 아키텍처와 Snowflake의 차이점
1. Shared-Disk 아키텍처
   
![Image](https://github.com/user-attachments/assets/8245e144-0675-4297-9e29-ad7ce4d55528)
    
- 모든 노드(Node)가 **공유 스토리지(Storage)** 를 사용한다.
- 데이터가 중앙 저장소에 있어, **모든 노드가 동일한 데이터에 접근이 가능** 하다.
- 노드가 증가할수록 **동시 접근 문제(Contention)** 가 발생할 수 있다.
- (ex) Oracle RAC, IBM Db2

2. Shared-Nothing 아키텍처
   
![Image](https://github.com/user-attachments/assets/d55420fe-968a-404a-bf71-158383b3f0d3)
    
- **스토리지와 컴퓨팅을 완전히 분리** 한다.
- 각 노드가 **자신만의 독립적인 디스크와 컴퓨팅 리소스를 보유** 한다.
- 병렬 처리(Parallel Processing)에 강점이 있지만, **데이터 이동이 필요할 경우 성능 저하** 가 발생할 수 있다.
- (ex) Hadoop, Amazon Redshift

### Snowflake 는 하이브리드 아키텍처

![Image](https://github.com/user-attachments/assets/94a461f9-3922-41c2-a48f-6ad544dc201e)

- **Snowflake는 Shared-Disk와 Shared-Nothing 구조를 결합한 하이브리드 아키텍처** 이다!
- 모든 데이터를 중앙 집중화하는 **공유 스토리지(Storage) 계층에 있는** 반면,
- **컴퓨팅은 독특하게 분리**되어 있다. 

## 1. 스토리지(Storage) 레이어 
![Image](https://github.com/user-attachments/assets/7582d245-f1bd-4e9e-8af9-56f54b5911db)

- Snowflake 는 데이터를 컬럼(Columnar) 형식으로 저장한다.
- 자동 압축 및 최적화를 수행한다.(사용자가 직접 데이터 정리를 할 필요가 없다.)
    
    - 스토리지의 주요 기능
        - 데이터를 자동으로 정리한다.(Partioning & Clustering) -> 데이터에 접근 및 분석을 용이하게 해준다.
        - 데이터 압축(Compression) 최적화(컬럼 형식으로 저장하므로)
        - **테이블(Table), 스키마(Schema), 데이터베이스(Database)** 로 구성된다. -> 필요한 정보를 더 쉽게 관리하고 검색할 수 있게 해준다.
        - 사용자가 직접 스토리지를 관리하지 않아도 **Snowflake가 내부적으로 최적화**

- 컬럼 기반 저장 방식 덕분에 쿼리 성능이 크게 향상된다!

## 2. 컴퓨팅(Compute) 레이어 : 가상 웨어하우스(Virtual Warehouse)
![Image](https://github.com/user-attachments/assets/924775ce-269d-4608-ab4e-09ffe165e641)

- Snowflake에서 Compute layer 는 **쿼리가 수행되며 값진 인사이트로 전환되는 마법과 같은 엔진룸** 이라고 보면 된다. -> Query Processing
- Snowflake는 이를 달성하기 위해 **가상 웨어하우스** 를 사용한다.

- 가상 웨어하우스(Virtual Warehouse) 란?
    - Snowflake 에서 쿼리를 실행하는 **임시 컴퓨팅 리소스**를 말한다. -> 쿼치 처리를 위해 특별히 설계된 컴퓨터 팀이라고 보면 된다.
    - 사용자가 쿼리를 실행하면 Snowflake는 **필요한 컴퓨팅 리소스를 동적으로 할당** 한다.

    - 가상 웨어하우스의 주요 기능
        - **자동 확장(Auto Scaling)** : 필요한 만큼 리소스를 늘리거나 줄일 수 있다.
        - **병렬 처리(Parallel Processing)** : 여러 가상 웨어하우스가 동시에 실행 가능하다.
        - **사용량 기반 과금(Pay-as-you-go)** : 사용한 만큼 비용을 지불한다.

- 가상 웨어하우스를 활용하면, 원하는 성능에 맞게 Snowflake 를 조절할 수 있다!

## 3. 클라우드 서비스(Cloud Services) 레이어
![Image](https://github.com/user-attachments/assets/50508542-bab0-49d6-8933-a1e74a29c3c5)

- Cloud layer 는 쿼리를 실행할 때 올바른 리소스외 컴퓨팅과 저장이 효율적으로 더 빠른 결과를 얻도록 보장한다. 
- 클라우드 서비스 레이어는 Snowflake 의 관리 및 보안 기능을 담당한다. -> 지휘자 역할을 하며 모든 것을 조정하는 계층

    - 클라우드 서비스의 주요 기능
        - **쿼리 최적화(Query Optimization)** : 실행 계획(Execution Plan) 최적화 -> Optimizer
        - **보안(Security)** : 사용자 인증, 암호화 관리 
        - **데이터 액세스 관리** : 데이터 공유(Data Sharing) 및 접근 제어
        - **메타데이터 관리** : 테이블, 인덱스, 스키마 정보 유지

- Snowflake의 클라우드 서비스는 **사용자의 개입 없이 모든 관리 작업을 자동으로 처리** 한다!


![Image](https://github.com/user-attachments/assets/2f211277-4a85-4da3-83a3-5e4ea1c1e1a0)


## Snowflake 아키텍처의 주요 장점 및 결론
1. 스토리지와 컴퓨팅의 완전한 분리
    - 사용자는 필요한 만큼의 컴퓨팅 리소스만 할당하여 비용 절감이 가능하다.
2. 고성능 데이터 처리
    - 컬럼 저장 방식과 자동 최적화를 통해 대용량 데이터 쿼리 속도가 향상된다.
3. 자동 확장(Auto Scaling)
    - 가상 웨어하우스를 확장하여 동시 사용자 증가에도 성능 유지가 가능하다.
4. 사용량 기반 과금(Pay-as-yo-go)
    - 스토리지와 컴퓨팅 비용을 따로 청구하여 비용을 최적화한다.
5. 멀티 클라우드를 지원한다.
    - AWS, Google Cloud, Azure 에서 모두 사용이 가능하다.

- Snowflake 는 클라우드 환경에서 데이터 분석을 최적화한 강력한 솔루션이다!

<hr>

## Snowflake 와 경쟁 데이터 플랫폼 비교 및 차별점
- Snowflake 와 Google BigQuery, Amazon Redshift, Databricks 및 PostgreSQL 을 비교하고 차별점과 장점을 살펴보자.

## Snowflake 의 주요 경쟁 플랫폼
![Image](https://github.com/user-attachments/assets/1aba97cf-ba2d-4589-b469-105c407b92dd)

- 클라우드 데이터 웨어하우스
    - **Google BigQuery**, **Amazon Redshift**, **Databricks** 등이 있다.

- 온프레미스(자체 구축형) 데이터베이스
    - **PostgreSQL**

## 아키텍처(Architecture) 비교
![Image](https://github.com/user-attachments/assets/ffd7b152-fd06-4918-aaa5-880582d92c2a)

- Snowflake, BigQuery, Databricks 는 스토리지와 컴퓨팅을 분리하여 **유연한 확장이 가능** 하다.
- Redshift는 기본적으로 결합된 구조이나 일부 옵션에서는 분리가 가능하다.
- PostgreSQL은 온프레미스 환경에서 운영되며 확장성이 제한된다.

## 확장성(Scalability) 비교
![Image](https://github.com/user-attachments/assets/6dd6cf4a-54f7-4212-a9fd-a4e60291a99a)

- Snowflake, BigQuery, Databricks 는 **자동확장(AutoScaliing)을 지원하여 성능 최적화가 가능** 하다.
- Redshift는 확장이 가능하지만, 다소 딜레이가 발생할 수 있다.
- PostgreSQL은 확장이 어렵고, 수동으로 클러스터링 해야 한다.

## 관리 부담(Management) 비교
![Image](https://github.com/user-attachments/assets/0f77880e-568a-45aa-838e-55b7244a04a3)

- Snowflake와 BigQuery는 자동화된 관리 기능으로 운영 부담이 적다.
- Databricks, Redshift 는 일부 관리 작업이 필요하다.
- PostgreSQL은 직접 관리해야 하므로 유지보수 부담이 크다.

## 보안(Security) 비교
- 모든 플랫폼은 **암호화(Encryption) 및 접근 제어(Access Control)** 기능을 제공한다.
- 데이터 보호 방식은 각 플랫폼마다 다르다.

## 데이터 지원(Data Support) 비교
![Image](https://github.com/user-attachments/assets/79d36503-d63d-45b5-af80-4b21d2c21d55)

- Databricks는 **비정형(Un-Structured) 데이터까지 지원** 하여 머신러닝 및 AI 작업에 유리하다.
- Snowflake, BigQuery, Redshift 는 주로 **구조화 및 반구조화** 데이터 처리에 최적화되어 있다.
  
## 클라우드 통합(Integration) 비교
![Image](https://github.com/user-attachments/assets/4bfbca63-dd82-4a2c-8b00-5ee2b7191641)

- Snowflake, BigQuery 는 AWS,GCP,Azure 모두 지원하여 **유연한 멀티 클라우드 운영이 가능** 하다.
- BigQuery는 GCP 중심이지만, **일부 클라우드 연결 기능을 제공** 한다.
- Redshift는 **AWS 전용 서비스** 이다.

## 가격 정책(Pricing) 비교

- Snowflake : 사용량 기반 과금(Pay-as-you-go) -> 유연한 사용량 기반 과금 모델로 비용 최적화가 가능하다.
- BigQuery : 데이터 처리량 기반 과금(온디맨드 또는 **슬롯** 기반) -> 데이터 처리량을 기준으로 가격이 결정된다.
- Databricks : VM 및 컴퓨팅 리소스 사용량 기반
- Redshift : 스토리지 및 컴퓨팅 비용 분리 가능(기본은 통합)
- PostgreSQL : 오픈소스(무료)지만, **클라우드 호스팅 시 비용발생** -> 자체 운영 시 무료이지만, 클라우드에서 실행하면 비용이 발생한다. 

## Snowflake VS PostgreSQL
- SnowflakeSQL은 ANSI(American National Standard Institute) SQL 기반으로 **PostgreSQL과 유사한 문법을 사용** 한다.
- 기본적인 SQL 쿼리는 PostgreSQL 과 **동일하게 작동** 한다.
- 일부 함수 및 기능에서 차이가 있지만, PostgreSQL 사용자는 쉽게 적응이 가능하다.
- (ex)
```
SELECT * FROM orders;
```
- PostgreSQL과 SnowflakeSQL에서 **동일하게 실행 가능** 하다!

<hr>

## Snowflake 연결 방법 및 DDL 명령어 정리

## Snowflake 연결방법
1. **Snowsight(웹 인터페이스)**
- Snowsight 는 Snowflake의 공식 웹 인터페이스이다.
- SQL 실행 및 데이터베이스 관리가 가능하다.
- **GUI 기반** 으로 사용이 간편하다.
- 워크시트(Worksheets)에서 SQL 실행이 가능하다.
- 데이터베이스, 스키마, 테이블, 뷰를 탐색할 수 있다.
- 가장 쉽게 Snowflake에 접속할 수 있는 방법이다!

2. **ODBC/JDBC 드라이버(외부 툴 연결)**
- ODBC(Open Database Connectivity) 및 JDBC(Java Database Connectivity) 드라이버를 지원한다.
- 연결 가능한 툴로는 DB Visualizer, Tableau, Power BI 등이 있다.
- Python, Java 등의 프로그래밍 언어에서도 Snowflake 데이터 활용이 가능하다.
- Snowflake 데이터를 **외부 BI 및 애플리케이션에서 활용이 가능** 하다!

3. **SnowSQL(CLI 기반 연결)**
- SnowSQL은 **Snowflake 전용 커맨드라인 인터페이스(CLI)** 이다.
- Snowflake 설치 후 **터미널에서 직접 Snowflake에 접속이 가능** 하다.
- PostgreSQL 의 psql 과 유사한 명령어 환경을 제공한다.
- 배치 작업, 자동화 스크립트 실행 등에 유용하다.
- (ex) SnowSQL을 사용한 Snowflake 연결 : snowsql -a <account_name> -u <username>
- **개발자 및 데이터 엔지니어가 선호하는 방법** 이다!

## Staging 개념 및 데이터 로딩 과정

### 1. Staging 이란?
- Staging 은 데이터 로딩 전 **임시 저장 공간** 을 말한다.
- **로컬 또는 클라우드 스토리지** 에서 **Snowflake 로 데이터를 이동할 때 사용** 한다.

- Staging의 종류
    - **Internal Stage : Snowflake 내부에 저장**되는 데이터
    - **External Stage** : Amazon S3, Google Cloud Storage 등 **외부 스토리지에 저장** 된 데이터

- 데이터 로딩 과정

  ![Image](https://github.com/user-attachments/assets/1790786a-bfee-4bdb-8fe8-8a60f0102945)
    
    - CSV 또는 JSON 등의 **원본 데이터 파일을 Staging에 업로드**
    - **COPY 명령어를 사용해 Snowflake 테이블로** 이동

### 2. CREATE Stage(스테이징 생성)
- CREATE STAGE 명령어로 스테이징을 생성한다.

(ex) orders.csv 파일을 위한 내부 스테이징 생성
```
CREATE STAGE my_stage;
```
(ex) PUT 명령어를 사용해 파일 업로드
```  
PUT file://orders.csv @my_stage;
```
(ex) COPY 명령어로 테이블로 데이터 이동    
```
COPY INTO orders FROM @my_stage;
```       

### 3. Snowflake DDL(Data Defintion Language) 명령어
- CREATE TABLE - 테이블 생성

    (ex) orders_pizza 테이블 생성
    ```
    CREATE TABLE orders_pizza (
        order_id INT PRIMARY KEY,
        customer_id INT,
        pizza_type VARCHAR(50),
        order_date DATE
    ); -- PostgreSQL 과 동일한 문법 사용!
    ```

- ALTER TABLE - 테이블 수정

    (ex) 테이블 이름 변경
    ```  
    ALTER TABLE orders_pizza RENAME TO orders;
    ```
    (ex) 컬럼 이름 변경    
    ```
    ALTER TABLE orders_pizza COLUMN order_date TO order_time;
    ```       
    (ex) 컬럼 추가   
    ```
    ALTER TABLE orders ADD COLUMN delivery_status VARCHAR(20);
    ```
    
- DROP TABLE - 테이블 삭제

    (ex) 테이블 삭제
    ```  
    DROP TABLE orders;
    ```
    (ex) 테이블 존재 시 삭제 (안전 모드)
    ```
    DROP TABLE IF EXISTS orders;
    ```
    
- COMMENT - 주석 추가

    (ex) 컬럼 주석 추가
    ```  
    ALTER TABLE pizza_type MODIFY COLUMN pizza_type_id COMMENT 'Unique ID for pizza types';
    ```
    (ex) 테이블 주석 추가
    ```
    CREATE TABLE pizza_type (
    pizza_type_id INT PRIMARY KEY,
    pizza_name VARCHAR(100) COMMENT 'Type of pizza',
    category VARCHAR(50)
    ) COMMENT = 'Stores pizza category details';
    ```       

### Snowflake 의 DDL 명령어는 PostgreSQL과 거의 동일하다. 단, 일부 추가 기능을(ex.Staging, Cloud Storage 연동)제공한다. PostgreSQL 사용자라면, 손쉽게 SnowflakeSQL 을 익힐 수 있다.

<hr>

##


# 데이터 웨어하우스 개념 

## 데이터 웨어하우스 라이프사이클
- 데이터 웨어하우스 프로젝트는 3가지 주요 단계로 구성된다.
  1) 계획 단계(Planning) : 요구사항 수집 및 데이터 모델링을 통해 데이터 웨어하우스의 구조를 정의한다.

     1-1) 요구사항 수집
      - data analyst : 비즈니스와 협업해 의사결정을 지원한다.
      - data scientist : 머신러닝 모델로 프로세스를 자동화하고 효율을 개선한다.

     1-2) 데이터 모델링
      - data engineer : 데이터 파이프라인을 설계한다.
      - database admin : 트랜잭션 데이터베이스를 관리한다.
      - data analyst & data scientist : 데이터 모델이 비즈니스 목표에 부합하는지 확인한다.
     
  3) 구현 단계(Implementation) : ETL(Extract, Transform, Load) 프로세스 설계 및 BI(Business Intelligence) 애플리케이션 개발을 한다.

     2-1) ETL 설계 및 개발
       - data engineer : 데이터 파이프라인을 구축한다.
       - database admin : 데이터 소스에서의 데이터 추출을 지원한다.

     2-2) BI 애플리케이션 개발
       - data analyst & data scientist : BI 도구 설정에 자문을 제공한다.
    
  5) 지원 및 유지보수 단계(Support & Maintenance) : 데이터 웨어하우스 업데이트, 테스트 및 배포를 진행한다.

     3-1) 유지보수
       - data engineer : 유지보수 및 업데이트를 실행한다.

     3-2) 테스트 및 배포
       - data analyst & data scientist : 시스템이 요구사항을 충족하는지 테스트한다.
       - data engineer : 시스템을 배포하고 조직에서 사용가능하게 한다.

  -> 주요 변경사항이 생기면 다시 계획단계(Planning)로 돌아간다.


## 각 단계별 주요 역할
1) 데이터 분석가 & 데이터 사이언티스트
  - 비즈니스 요구사항을 수집하고 BI 도구 설정을 지원한다.
2) 데이터 엔지니어 & 데이터베이스 관리자(admin)
  - 데이터 파이프라인을 구축하고, 원천 시스템에서 데이터 추출을 담당한다.

<hr>

## 데이터 웨어하우스 vs 데이터 레이크 vs 데이터 마트 

1) 데이터 베이스(Database)
     - 테이블(행과 열) 형태로 정보를 저장하는 구조화된 시스템이다.
     - 조직 내 트랜잭션 데이터를 저장하는 용도로 사용한다.
     - (ex) 고객 구매 정보를 저장한다.
     - 한계 : 대규모 분석 쿼리 수행 시 속도가 느려지고, 트랜잭션 처리 성능에 영향을 줄 수 있다.

2) 데이터 웨어하우스(Data Warehouse)
     - 조직의 **여러부서** 에서 **데이터를 통합** 하여 중앙 집중식 분석이 가능하도록 구축된 저장소이다.
     - **다양한 데이터 소스** (여러 데이터베이스, 로그 파일 등)에서 데이터를 수집한다.
     - ETL(Extract, Transform, Load) 프로세스를 통해 데이터를 구조화된 테이블 형태로 저장한다.
     - **100GB 이상으로 대규모 데이터 저장** 이 가능하다.
     - **구조 변경이 어렵고** , **upstream 및 downstream effect** 가 크다.
       (Upstream effects are those that occur before a product or service is used,
       while downstream effects are those that occur after a product or service is used.)

3) 데이터 마트(Data Mart)
     - 특정부서(ex.재무팀, 마케팅팀)에서 사용할 데이터만 저장하는 관계형 데이터베이스
     - 데이터 웨어하우스처럼 **구조화된 데이터를 저장** 하지만, **한 부서의 데이터만 포함** 한다.
     - 입력 데이터 소스가 적다.(주로 데이터 웨어하우스의 일부 데이터를 활용한다.)
     - 크기는 일반적으로 100GB 이하로, 데이터웨어하우스보다 작다.

4) 데이터 레이크(Data Lake)
     - 데이터 웨어하우스처럼 조직 전체 데이터를 저장하지만, **비정형 데이터(영상, 오디오, 이미지 등)도 저장** 할 수 있다.
     - 여러 부서의 데이터를 저장하며, **다양한 데이터 소스를 수용** 한다.
     - **데이터의 구조를 사전에 정의할 필요 없이** **유연하게 저장** 이 가능하다.
     - **데이터 활용 목적이 명확하지 않은 경우** 에도, 미래 분석을 위해 **데이터 보관이 가능** 하다.
     - **데이터 웨어하우스보다 유연한 구조를 가지며, 변경이 용이하다.**
  
   ![Image](https://github.com/user-attachments/assets/845b7168-0f87-4f60-9003-3bc328daa71d)

<hr>

## 데이터 웨어하우스 아키텍처와 4가지 레이어 
- 데이터 웨어하우스(Data Warehouse)는 **비즈니스 의사결정을 지원하기 위해 데이터를 **수집,저장,분석** 하는 시스템이다.
- 일반적으로 데이터웨어하우스는 **4가지 주요 레이어** 로 구성된다.

## 1. 데이터 소스 레이어(Data Source Layer)
- 데이터 웨어하우스의 첫 번째 단계로, **다양한 데이터 소스에서 데이터를 가져오는 역할** 을 한다.
- 주요 데이터 소스
    - 트랜잭션 데이터베이스 : 기업의 운영 시스템(ex.ERP, CRM, POS 시스템 등)
    - 파일 데이터 : CSV, JSON, XML 등
    - 기타 데이터 : 로그 데이터, 센서 데이터 등 구조적/비구조적 데이터

## 2. 데이터 스테이징 레이어(Data Staging Layer)
- **데이터를 변환하고 정제** 하는 단계로, ETL(Extract,Transform,Load) 프로세스를 포함한다.
    - ETL 프로세스
        1. Extract(추출) : 원본 데이터 소스에서 데이터를 가져온다.
        2. Transform(변환) : 데이터 정제, 비즈니스 규칙 적용, 포맷 변환 등을 수행한다.
        3. Load(적재) : 변환된 데이터를 데이터 웨어하우스에 저장한다.
     
- 스테이징 레이어에서는 데이터를 **임시 테이블(Stageing Table)** 에 저장하여 다음 단계에서 사용할 수 있도록 준비한다.

## 3. 데이터 저장 레이어(Data Storage Layer)
- **데이터를 장기적으로 저장** 하는 공간으로, 데이터 웨어하우스와 데이터 마트(Data Mart)로 구성된다.
    - 데이터 저장 방식
        - **데이터 웨어하우스 -> 데이터 마트** : 데이터가 먼저 웨어하우스에 저장된 후 특정 목적에 맞게 데이터 마트로 이동한다.
        - **데이터 마트 -> 데이터 웨어하우스** : 데이터 마트에서 특정 데이터를 먼저 저장하고 이후 웨어하우스로 통합된다.
    - * 데이터 마트(Data Mart)란?
          - 특정 부서나 목적(ex.마케팅, 인사, 영업)에 맞춰 세분화된 데이터 저장소
          - 성능 최적화 및 빠른 조회를 위해 활용된다.

## 4. 데이터 프레젠테이션 레이어(Data Presentation Layer)
- **사용자가 데이터를 조회하고 분석** 하는 단계로, 비즈니스 인텔리전스(BI)도구를 활용해 데이터를 시각화하고 인사이트를 도출할 수 있다.
    - 데이터 분석 도구
        - BI 툴 : PowerBI, Tableau, Looker 등
        - 데이터 마이닝 도구 : 머신러닝 기반 분석 활용
        - SQL 쿼리 : 직접 데이터 조회 및 분석

- 사용자는 대시보드, 그래프, 차트 등을 통해 데이터를 쉽게 이해하고, 의사결정에 활용할 수 있다.

<hr>

## 데이터 웨어하우스 프레젠테이션 레이어와 주요 도구 정리
- 데이터 웨어하우스의 **프레젠테이션 레이어(Presentation Layer)** 는 사용자가 데이터를 조회하고 분석하는 최종 단계이다. 이 단계에서는 다양한 도구를 활용하여 데이터를 시각화하고 인사이트를 도출할 수 있다. 프레젠테이션 레이어에서 사용되는 도구들은 크게 **3가지 그룹** 으로 나뉜다.

1. 자동화된 보고 및 대시보드 도구 : Tableau, Power BI 등을 사용해 시각적으로 데이터를 분석한다.
2. BI/데이터 분석 도구 : RapidMiner, KNIME 등을 활용해 패턴을 발견하고 인사이트를 도출한다.
3. SQL을 활용한 직접 쿼리 도구 : SQL, Python, R을 사용하여 맞춤형 데이터 분석을 수행한다.

## 1. 자동화된 보고 및 대시보드 도구(Automated Reporting & Dashboarding)
- 역할
    - 데이터를 자동으로 수집하여 보고서(Reports) 및 대시보드(Dashboard)를 생성한다.
    - 기업 내 데이터 통합을 통해 빠르고 정확한 의사결정을 지원한다.
 
- 주요 특징
    - 데이터를 한 곳에서 관리하여 **분석가** 들이 효율적으로 정보에 접근이 가능하다.
    - 보고서 자동화 기능을 통해 시간 절약 및 실시간 정보 제공이 가능하다.
    - 주 사용자는 **분석가, 일반 사용자들** 이다.

- 대표적인 도구

    ![Image](https://github.com/user-attachments/assets/7e3b9b3c-7753-424f-849b-7008694bcf30)
    - Tableau : 대시보드 시각화 및 분석
    - Power BI : Microsoft의 BI 솔루션
    - Google Looke : 클라우드 기반 데이터 시각화 도구
    - SAP BW : 대기업에서 많이 사용하는 데이터 웨어하우스 솔루션
 
- 활용 예시(ex)
    - 기업의 **매출 보고서** 를 자동으로 생성하여 실시간으로 확인 가능하다.
    - 마케팅팀이 특정 캠페인의 성과를 분석하고  **대시보드에서 시각적으로  확인** 한다.
 
## 2. BI 및 데이터 분석 도구(BI/Data Analytics) 
- 역할
    - **데이터 탐색 및 패턴 발견** 을 통해 기업의 전략 수립을 지원한다.
    - 데이터에서 인사이트를 도출하여 **비즈니스 의사결정에 도움** 을 준다.

- 주요 특징
    - **데이터 마이닝(Data Mining)** 기능을 제공하여 **트렌드 및 패턴 분석** 이 가능하다.
    - GUI 기반의 드래그 앤 드롭(Drag & Drop) 인터페이스 제공 (코딩 없이 분석 가능)
    - 필요 시 Python, R 등의 코드 기반 분석 기능도 제공한다.
    - 주 사용자는 **분석가, 데이터 사이언시트스** 이다.

- 대표적인 도구
  
    ![Image](https://github.com/user-attachments/assets/1d60bdb8-c55d-495a-8e51-a402c331f089)
    - Oracle Data Mining : 오라클 데이터베이스와 연동하여 데이터 분석을 한다.
    - RapidMiner : 머신러닝 및 데이터 마이닝을 지원한다.
    - Alteryx : 데이터 준비 및 분석 자동화한다.
    - KNIME : 오픈소스 데이터 분석 및 머신러닝 도구이다.

- 활용 예시(ex)
    - **매출 데이터에서 특정 지역의 매출 감소 원인을 분석** 한다.
    - **고객 구매 패턴을 분석하여 맞춤형 마케팅 전략 수립** 을 한다.

## 3. SQL을 활용한 직접 쿼리 도구(Direct Queries)
- 역할
    - 사용자가 **SQL을 직접 작성** 하여 데이터 웨어하우스에서 데이터를 추출한다.
    - **맞춤형 분석을 수행** 하고 **필요한 데이터만 필터링** 이 가능하다.

- 주요 특징
    - **기술적 역량이 있는 사용자(데이터 엔지니어, 데이터 사이언티스트)** 가 주로 사용한다.
    - 보다 정밀한 데이터 분석 및 조작이 가능하다.
    - Python, R 과 같은 프로그래밍 언어와 결합하여 **고급 분석 및 머신러닝 적용이 가능** 하다.
    - 주 사용자는 **분석가, 데이터 사이언티스트, 데이터 엔지니어** 이다.

- 대표적인 도구

    ![Image](https://github.com/user-attachments/assets/9a1b2753-482a-4e26-a1be-e618deb64fea)   
    - SQL Server Management Studio(SSMS) : Microsoft SQL Server 관리 도구
    - Azure Data Studio : 클라우드 환경에서 SQL 분석 지원하는 도구
    - Python & R : 데이터 분석 및 머신러닝을 위한 프로그래밍 언어

- 활용 예시(ex)
    - **특정 고객군의 구매 데이터를 SQL로 직접 추출하여 머신러닝 모델을 생성** 한다.
    - **R을 사용하여 판매 데이터의 이상치(Outlier)** 를 감지 및 분석한다.

=> 프레젠테이션 레이어는 **데이터 웨어하우스의 최종 사용자 인터페이스** 로, 비즈니스 의사결정에 핵심적인 역할을 한다.

<hr>

## 데이터 웨어하우스 아키텍처 
- 데이터 웨어하우스(Data Warehouse,DW)는 데이터를 수집, 저장, 분석하는 시스템이며, 이를 구축하는 방식에는 **Inmon(탑다운, Top-down)과 Kimball(바텀업,Bottom-up)** 두 가지 대표적인 아키텍처가 있다.

## 1. Inmon 의 Top-down 방식
- 개념
    - Bill Inmon이 제안한 데이터 웨어하우스 설계 방식이다.
    - 데이터를 **중앙 집중형 웨어하우스에서 먼저 정규화(Normalization)하여 저장한 후** , **부서별 데이터 마트(Data Mart)로 전달** 한다.
![Image](https://github.com/user-attachments/assets/a453ecf4-47ee-4f81-88b3-a78dee4b68c4)

- 특징
    - 모든 데이터의 표준화가 필요
        - 데이터를 웨어하우스로 이동하기 전에 **데이터 정의, 명명 규칙, 정합성 기준** 등을 조직 전체가 합의해야 한다.
    - 정규화된 데이터 저장 구조
        - **데이터 정규화(Normalization)** 을 통해 데이터 중복을 최소화하고 데이터 품질을 향상시킨다.
    - 데이터 마트는 웨어하우스에서 파생
        - 데이터는 **먼저 웨어하우스에 저장** 되고, 이후 부서별 **데이터 마트(Data Mart)로 이동** 한다.

- 장점(Pros)
    1. **데이터의 일관성과 신뢰성을 보장** 한다.
        - 모든 데이터를 표준화하여 **기업 내 단일 진실(Single Source of Truth, SSOT)** 을 유지한다.
    2. **데이터 중복을 최소화** 한다.
        - **정규화된 데이터로 저장** 되어 **불필요한 데이터 중복이 줄어든다.**
    3. **데이터 마트 확장이 용이** 하다.
        - **표준화된 데이터를 기반** 으로 **데이터 마트를 손쉽게 추가** 할 수 있다.

- 단점(Cons)
    1. **데이터 조회 속도가 느릴 수 있다.**
        - **정규화로 인해 많은 JOIN 연산이 필요** 하여 보고서 생성 시 **성능 저하가 발생할 수 있다.** 
    2. **초기 구축 비용이 높다.**
        - **전체 데이터를 표준화**해야 하므로 **설계 및 정합성 확보에 많은 시간과 비용** 이 소요된다. 

## 2. Kimball 의 Bottom-up 방식
- 개념
    - Ralph Kimball이 제안한 방식으로, **데이터를 먼저 비정규화(Denormalization)** 한 후, **데이터 마트를 구축하여 빠르게 보고서 및 분석이 가능** 하게 한다.
    - **스타 스키마(Star Schema)** 를 사용하여 **데이터 쿼리 속도를 최적화** 한다.
![Image](https://github.com/user-attachments/assets/bb158604-ee26-4e17-b0a7-c7a320f0f0c8)

- 특징
    - 빠른 데이터 분석 가능
        - 데이터를 부서별로 정리하여 **각 부서의 데이터 마트(Data Mart)를 먼저 구축** 한 후, **웨어하우스로 통합** 한다.
    - 데이터 구조를 단순화하여 쿼리 실행 속도를 빠르게 함
        - 데이터 구조를 단순화하여 **쿼리 실행 속도를 빠르게 한다.**
    - 부서 단위 확장 가능
        - 한 부서의 데이터 마트를 구축한 후, **다른 부서로 확장하는 방식** 이다.

- 장점(Pros)
    1. **빠른 구축이 가능** 하다.
        - **부서별 데이터 마트를 먼저 구축하고 확장하는 방식** 이므로 **초기 구축 비용이 적고, 빠르게 적용이 가능** 하다.
    2. **쿼리 속도를 향상** 시킬 수 있다.
        - **비정규화된 데이터 구조 덕분** 에 **JOIN 연산이 적고** **보고서 생성속도가 빠르다.**
    3. **유연한 확장성** 을 갖춘다.
        - **필요에 따라 부서별로 데이터 마트를 추가** 할 수 있다.
        
- 단점(Cons)
    1. **ETL 프로세스 시간을 증가** 시키고 **데이터 중복 발생** 이 나타날 수 있다.
        - **비정규화된 데이터 모델** 이므로 **ETL 프로세스 시간을 늘어날** 수 있고, **여러 데이터 마트에서 중복된 데이터가 발생할 위험이 있다.** 
    2. **데이터 정합성 문제** 가 나타날 수 있다.
        - 동일한 데이터(중복 데이터)가 여러 데이터 마트에서 다르게 계산될 가능성이 있어 **기업의 단일 진실(SSOT)를 유지하기 어렵다.**
        - (ex) 동일한 이름을 가진 'revenu'라는 필드가 두 개의 데이터마트에 있고, 한 데이터 마트에서는 상품비용으로 계산되는데, 다른 데이터마트에서는 그러지 않는 경우
    3. **장기적인 관리 비용이 증가** 할 수 있다.
        - **새로운 부서를 추가할 때마다 추가적인 개발과 데이터 통합 작업이 필요** 하다.

## 데이터 웨어하우스 아키텍처는 기업의 목표와 데이터 활용 방식에 따라 적절한 모델을 선택하는 것이 중요하다.
![Image](https://github.com/user-attachments/assets/086f6ddb-169e-44ef-801a-3cc1a4a1e5eb)
- **기업이 장기적인 데이터 품질과 일관성을 중요하게 여긴다면, Inmon(Top-Down) 방식이 적합**하다.
- **빠른 데이터 분석과 유연한 확장이 필요하다면, Kimball(Bottom-Up) 방식이 적합**하다.

<hr>

## OLAP vs OLTP : 데이터 웨어하우스에서의 차이점과 개념 정리
- 데이터 웨어하우스에서 중요한 개념 중 하나는 **OLAP(Online Analytical Processing)** 과 **OLTP(Online Transaction Processing)** 이다.
- 이 두 개념은 데이터 처리 방식이 다르며, **분석용(OLAP) vs 트랜잭션 처리용(OLTP)** 로 구분된다.

## 1. OLAP(OnLine Analytical Processing) 시스템
- OLAP는 **대용량 데이터를 고속으로 다차원 분석** 할 수 있도록 설계된 시스템이다.
- 주로 **데이터 웨어하우스(Data Warehouse) 및 데이터 마트(Data Mart)** 에서 활용된다.
- 다차원 분석을 수행하여 **데이터의 패턴과 트렌드를 파악하는데 사용** 된다.
- 주로, 데이터 사이언티스트나, 데이터 분석가, 경영진 및 의사결정자들이 사용하여 작업한다.

### OLAP 의 핵심개념 : 다차원 분석(Multidimensional Analysis)
- 데이터 웨어하우스의 데이터는 **행(row)과 열(column)** 형태로 저장된다. => **2차원 표현**
- OLAP 시스템은 이를 **다차원(Multidimensional) 형태로 변환** 하여 분석 성능을 향상시킨다.
- 이러한 다차원 형식을 사용하면, 데이터 분석 시 **슬라이싱(Slicing)과 다이싱(Dicing)** 기능을 활용할 수 있다.

### OLAP 의 핵심요소 : OLAP 데이터 큐브(OLAP Data Cube)
- OLAP 큐브란
    - OLAP 시스템에서 데이터를 빠르게 조회하기 위해 사용하는 **다차원 데이터 모델** 이다.
    - **3차원 이상** 의 데이터를 저장하여 여러 차원에서 분석이 가능하다.

- OLAP 큐브 예제
  ![Image](https://github.com/user-attachments/assets/e5caeacd-888c-48d9-8ac5-e464bf7447c3)
    - 신용카드 회사의 매출 분석
        - 차원(Dimension) : 지역(Region), 연도(Year), 제품(Product)
        - 값(Measures) : 총 매출(Total Sales)
    - **높이, 너비, 길이는 이러한 차원 중 하나** 를 나타내고, **모서리가 교차하는 차원에 대한 총 매출** 을 얻게 된다.

    - OLAP 큐브를 활용하여 **각 차원별로 데이터를 집계(Aggregation) 및 분석** 할 수 있다.

- OLAP 큐브의 확장 : **하이퍼 큐브(Hypercube)**
    - **3차원 이상** 으로 확장된 데이터 모델이다.
    - **보다 복잡한 데이터 분석에 활용** 된다.

### 예시
- 매출 데이터 분석 : 국가 -> 주(도) -> 도시 등 계층 구조로 데이터를 분석한다.
- 시간 기준 분석 : 연도 -> 월 -> 일별로 판매량을 비교한다.
- 제품별 분석 : 특정 제품군의 지역별 판매량을 비교한다.


## 2. OLTP(OnLine Transaction Processing) 시스템
- OLTP는 **온라인 트랜잭션을 빠르게 처리** 하는 시스템이다.
- 은행, 전자상거래, 예약 시스템 등 **실시간 데이터 입력/수정/삭제 가 빈번한 환경** 에서 사용한다.

### OLTP 의 특징
- **단순한 데이터 처리(INSERT,UPDATE,DELETE 연산)**
- **빠른 응답 속도**
- **소수의 행(Row)에 대한 변경 처리** : 데이터베이스 내의 몇몇 데이터 행에만 영향을 미치는 경우를 말하는게 많다.
- 비즈니스에 필수적이지만, 분석에는 사용되지 않고 **실시간 데이터 저장소 역할** 을 하거나 데이터베이스나 데이터 웨어하우스에 데이터를 공급하는 소스 시스템에서 이를 사용한다.
- 주로, 데이터 엔지니어나, 데이터베이스 관리자들이 사용하여 작업한다.

### 예시
- ATM 거래 처리
- 온라인 쇼핑몰 결제 시스템
- 항공사 예약 시스템

### OLTP 시스템이 중요한 이유는?
- 기업의 운영을 실시간으로 지원하는 **핵심 시스템** 이기 때문이다.
- **빠른 데이터 입력과 처리가 가능** 하게 한다.

## OLAP vs OLTP 비교
![Image](https://github.com/user-attachments/assets/5e41dbc3-f5ef-49bb-877b-8df0549755fe)

- OLTP 시스템 -> 데이터 웨어하우스 -> OLAP 시스템
    - OLTP 시스템이 생성한 데이터를 데이터 웨어하우스에 저장한 후,
    - OLAP 시스템이 웨어하우스에서 데이터를 분석한다.

- 예시(ex)
  - 신용카드 회사의 OLAP & OLTP 사용
      - OLTP : 신용카드 결제 시스템 : 실시간 결제 승인 및 잔액 업데이트 -> 실시간 처리에 집중
      - OLAP : 신용카드 사용 패턴 분석 : 지역별, 연령별 소비 트렌드 분석 -> 분석이나 인사이트에 집중

- 효율적인 데이터 분석을 위해 OLTP 와 OLAP 의 역할을 적절히 활용하는 것이 중요하다!

<hr>

## 데이터 웨어하우스 데이터 모델링 : 스타 스키마 vs 스노우플레이크 스키마
- 데이터 웨어하우스에서 데이터를 효과적으로 저장하고 분석하려면, **데이터 모델링(Data Modeling)** 이 필수적이다.
- 데이터 모델링이란, **데이터를 테이블로 구성하고, 서로 관계를 맺어(join) 효율적으로 관리하는 방식** 을 의미한다.

## 1. 데이터 모델(Data Model)
![Image](https://github.com/user-attachments/assets/c2f25ac4-d648-49c7-b40f-1bae9a7a281c)
- 데이터 웨어하우스에서 널리 사용되는 두 가지 주요 데이터 모델은 **스타 스키마(Star Schema)** 와 **스노우플레이크 스키마(Snowflake Schema)** 이다.
- 이 두 가지 모델은 **Kimball의 바텀업(Bottom-up) 데이터 웨어하우스 아키텍처** 에서 사용되며, 데이터를 **비정규화(Denormalization)** 하여 분석 성능을 높이는 방식이다.

## 2. 팩트 테이블(Fact Table) vs 차원 테이블(Dimension Table)

1) 팩트 테이블(Fact Table)
    - **측정값(Measure) 또는 지표(Metric)** 을 저장하는 테이블 이다.
    - **트랜잭션 데이터** 를 포함하며, **행(Row) 마다 특정 이벤트(ex.구매, 주문)** 을 나타낸다.
    - **외래키(Foreign Key)** 로 여러 **차원 테이블(Dimension Table) 과 연결** 된다.

- 팩트 테이블 예시(ex. Bravo 가구 회사의 매출 데이터)
![Image](https://github.com/user-attachments/assets/1342e532-6d25-41c2-8303-a0e24c1f82a0)
    - 팩트(Fact) 값이 포함되어 있다.(ex.판매량, 세금, 총 매출 등)
    - **외래 키(FK)** 를 사용하여 **차원 테이블(Dimension Table)과 연결** 된다.
    - 데이터 분석 시 **수학적 연산이 적용될 수 있는 값** 들이 포함된다.

2) 차원 테이블(Dimension Table)
    - **팩트 테이블을 설명하는 속성(Attribute)을 저장** 하는 테이블
    - 분석할 때 **필터링, 그룹핑, 세부 분석** 을 가능하게 한다.
    - 팩트 테이블과 **1:N 관계(One-to-Many RelationShip)** 을 가진다.

- 차원 테이블 예시(ex. 고객 정보)

  ![Image](https://github.com/user-attachments/assets/4bc86d74-723a-41db-89d5-baea240f96c9)
    
    - 팩트 테이블을 보완하여 **상세정보를 제공** 한다.
    - 분석을 위한 **필터(Filter) 및 그룹화(Grouping)** 가 가능하다.
    - **하나의 팩트 테이블이 여러 차원 테이블과 연걸** 될 수 있다.

## 3. 스타 스키마
- 하나의 **팩트 테이블** 을 중심으로 여러 개의 **차원 테이블**이 연결된 형태이다.
- 스키마 구조가 **별(star) 구조 모양** 을 이루므로, **스타 스키마** 라고 불린다.
- **조인이 적어 쿼리 속도가 빠르고 분석이 용이** 하다.

## 스타 스키마 예시(Star Schema)
![Image](https://github.com/user-attachments/assets/6f641dba-49c2-4238-828f-fcd111c1dae6)
- (팩트 테이블) : Sales_Order_Fact
  - 판매량, 세금, 총 매출과 같은 측정값을 포함한다.
- (차원 테이블) : Customer_Dim, Product_Dim, Date_Dim
  - 고객(Customer_Dim) : 고객의 이름, 이메일, 국가 등을 저장
  - 제품(Product_Dim : 제품명, 카테고리, 브랜드 등을 저장
  - 날짜(Time_Dim) : 연도, 월, 일 정보를 저장

- 스타 스키마의 장점(Pros)
    - 빠른 분석 속도(JOIN 이 적다.)
    - 단순한 구조로 이해하기 쉽다.
    - 비즈니스 분석가도 쉽게 사용할 수 있다.

- 스타 스키마의 단점(Cons)
    - 중복된 데이터가 존재할 가능성이 있다.(비정규화로 인해)
    - 데이터 저장 공간을 더 많이 사용할 수 있다.

## 4. 스노우플레이크 스키마(Snowflake Schema)
- 스타 스키마에서 **일부 차원 테이블이 정규화(Normalization)된 형태** 이다.
- 즉, 차원 테이블이 **더 작은 하위 테이블로 분할** 된 셈이다.
- 스키마 구조가 **눈꽃(Snowflake) 모양** 을 이루므로, **스노우플레이크 스키마** 라고 불린다. 

## 스노우플레이크 스키마 예시
![Image](https://github.com/user-attachments/assets/358b96b9-f847-4327-bb86-b679dcb02597)

- Customer 테이블에서 Country 테이블이 분리되어 있는 나온 형태이며, **데이터 모델이 눈송이 처럼 변한다.**
- Country 테이블은 Customer 이라는 **차원 테이블을 통해서만 팩트 테이블과 join 할 수 있다.**
   
- 스노우플레이크 스키마의 장점(Pros)
    - **데이터의 중복이 최소화** 된다.(**정규화** 된 데이터구조)
    - 데이터 **저장 공간 절약이 가능** 하다.
   
- 스노우플레이크 스키마의 단점(Cons)
    - **JOIN 연산이 많아 쿼리 성능이 저하될** 수 있다.
    - **구조가 복잡해 이해하기 어려울** 수 있다.


## 스타 스키마 VS 스노우플레이크 스키마 비교
![Image](https://github.com/user-attachments/assets/a3abbb77-b9b6-48d8-8588-ca189c9c3f25)


### 스타 스키마 : 쿼리 속도가 빠르고 분석이 용이하므로 BI 도구와 함께 사용하기 좋다.
### 스노우 플레이크 스키마 : 저장 공간을 절약할 수 있지만, JOIN 연산이 많아 성능이 저하될 수 있다.

<hr>

## Kimball 의 4단계 데이터 모델링 프로세스
- 데이터 웨어하우스에서 **효율적인 데이터 모델을 설계하는 과정** 은 매우 중요하다.
- 특히, **Ralph Kimball 의 바텀업(Bottom-up) 접근법** 에서는 데이터 마트를 구축하기 위해 **스타 스키마(Star Schema)** 또는 **스노우플레이크 스키마(Snowflake Schema)** 를 적용한다.
- Kimball은 데이터 모델링을 위한 4단계 프로세스를 제시했으며, 이 프로세스를 따르면, **비즈니스 요구사항을 반영한 최적의 데이터 모델** 을 설계할 수 있다.

## 1. Kimball의 4단계 데이터 모델링 프로세스 
- 1단계 : 조직의 비즈니스 프로세스 선택
- 2단계 : 그레인(Grain) 정의
- 3단계 : 차원(Dimension) 식별
- 4단계 : 팩트(Fact) 식별
 
### 1단계 : 조직의 비즈니스 프로세스 선택
- 데이터 웨어하우스에서 **모델링할 비즈니스 프로세스를 선택** 하는 단계이다.
- 데이터 마트에서 다룰 특정 부서(영업, 마케팅, 회계 등)를 결정한다.

- 예시
    - 영업부서 : 주문 및 청구
    - 품질 관리 부서 : 제품 품질 모니터링
    - 마케팅 부서 : 캠페인 성과 분석
 
- 왜 중요한가?
    - 분석하고자 하는 프로세스를 정의해야 데이터 모델을 만들 수 있다.
    - 사용자(Analyst,Manager)가 필요로 하는 정보를 반영하기 위해 필수적인 단계이다.
 
### 2단계 : 그레인(Grain) 정의
- 팩트 테이블에서 **데이터를 저장하는 가장 낮은 단위** (Level of Detail)
- 가능한 한 **가장 세부적인 데이터 단위** 로 설정하는 것이 좋다.

- 예시
    - 음악 스트리밍 서비스 : 개별 곡(Song)단위 저장 (앨범 단위 x)
    - 배송 데이터 모델링 : 개별 품목(Line Item)단위 저장 (전체 배송 단위 x)

- 왜 중요한가?
    - 데이터 분석의 **정밀도** 를 결정한다.
    - 세부 데이터가 있어야 **다양한 질문에 답할 수 있다.** (ex.가장 인기있는 곡은?)
    - 그레인이 너무 크면 데이터 분석의 유용성이 떨어질 수 있다.

### 3단계 : 차원(Dimension) 식별
- 차원 테이블은 팩트 테이블을 설명하는 속성 데이터이다.
- 이런 **차원 테이블을 사용하여 데이터를 필터링, 그룹핑 및 상세 분석이 가능** 하다.

- 예시
    자주 사용되는 예시들이다.
    - 시간(Time) : 연도(Year), 월(Month), 일(Day), 분기(Quarter)
    - 위치(Location) : 주소(Address), 도시(City), 국가(Country)
    - 사용자(User) : 이름(Name), 이메일(Email), 고객 유형(Customer Type)
  
    - 음악 스트리밍 서비스
      
        ![Image](https://github.com/user-attachments/assets/4896dd12-f32a-4204-9cd3-cd037beb91e2)

- 왜 중요한가?
    - 차원 데이터를 통해 **팩트 테이블을 더욱 풍부한 정보로 분석이 가능** 하다.
    - **데이터를 다양한 기준(시간,위치,사용자 등)으로 분류하고 그룹화** 할 수 있다.

### 4단계 : 팩트(Fact) 식별
- 팩트 테이블은 측정값(Measure) 또는 수치 데이터(Numeric Facts) 를 저장한다.
- 팩트 값은 **팩트 테이블의 각 행(Row)** 에서 **수학적 연산이 가능** 해야 한다.

- 예시
    - 음악 스트리밍 서비스 : 재생 횟수(Play Count), 곡 매출(Song Revenue)
    
      ![Image](https://github.com/user-attachments/assets/8b0a7503-e06b-44ed-b5cc-155f1570df22)
    - 승차 공유 서비스 : 이동 거리(Distance), 운행 시간(Ride Time)

- 왜 중요한가?
    - 팩트 테이블의 **수치 값이 분석의 핵심** 이 된다.
    - 조직의 주요 질문에 대한 답을 직접적으로 제공한다.(ex.가장 많이 재생된 곡은?)

<hr>

## Slowly Changing Dimensions(SCD) : 변화하는 차원 데이터 처리 방식
- 데이터 웨어하우스에서는 **시간이 지나면서 변경되는 차원(Dimension) 데이터를 어떻게 다룰 것인가?** 라는 문제가 발생한다.
- 이를 해결하기 위해 **Kimball 의 Slowly Changing Dimension(SCD, 서서히 변화하는 차원) 접근 방식** 이 널리 사용된다.
- 주로 SCD의 세 가지 유형(Type I, II, III)과 현대적인 접근 방식이 있다.

### SCD(서서히 변화하는 차원) 접근 방식 이란?
- **차원 테이블** (Dimension Table)에서 **시간이 지나면서 변경되는 값을 다루는 방법** 이다.
- 예를 들어, 자동차 판매점 데이터 웨어하우스에서 Tesla Model Y 의 분류가 전기차(Electric Vehicle) 에서 전기 크로스오버(Electric Crossover) 로 변경되었다면, **팩트 테이블(Fact table)의 데이터는 변하지 않지만** , **차원 테이블의 데이터는 변경** 될 수 있다.

## 1. SCD Type I : 기존 값 덮어쓰기(Overwrite Old Value)
- 방법
    - **기존 값을 새로운 값으로 직접 업데이트** 한다.(덮어쓰기)
    - **과거 데이터를 유지하지 않는다.**
    - 보고서를 다시 실행하면 모든 데이터가 새로운 값으로 변경된다.

- 예시
  
    ![Image](https://github.com/user-attachments/assets/ed357b6d-0a5a-401d-8220-1ba43e4b83e4)

    카테고리 값 변경 후
    
    ![Image](https://github.com/user-attachments/assets/0ee3db1f-7f66-4efa-aa5c-2b50612d6c69)

### 장점(Pros)
  - **데이터 관리가 단순** 하다.
  - **저장 공간을 절약** 할 수 있다.
    
### 단점(Cons)
  - 과거 데이터를 유지할 수 없다. : 과거 보고서를 실행해도 최신 데이터만 반영된다.
  - **재현성 문제** : 동일한 보고서를 실행해도 결과가 달라질 가능성이 있다.

### 사용 사례
  - **과거 데이터가 중요하지 않거나, 최신 데이터만 유지하면 되는 경우**
  - 고객 주소 변경 등 이력이 필요 없는 데이터
    

## 2. SCD Type II : 새로운 행 추가(Create a New Row)
- 방법
    - **기존 데이터를 유지하고, 새로운 값이 있는 새로운 행(Row)을 추가** 한다.
    - **새로운 Product_ID 를 부여하여 새로운 데이터를 기록** 한다.
    - **Start_Date, End_Date 등의 컬럼을 추가**하여 **유효 기간** 을 관리한다.

- 예시
  
    ![Image](https://github.com/user-attachments/assets/efacaf23-4e56-4c82-96ee-e914db81494b)


### 장점(Pros)
  -  **과거 데이터를 유지** 할 수 있다.
  -  **시간에 따른 데이터 변화 추적** 이 가능하다.
  -  **과거와 현재 데이터를 동시에 분석** 할 수 있다.
    
### 단점(Cons)
  - 데이터 **저장 공간이 증가** 한다.(새로운 행을 추가하기 때문에)
  - **조인(JOIN)연산이 많아질 수** 있다.

### 사용 사례
  - **고객의 등급 변경** (ex.브론즈->실버->골드)
  - 직원의 부서 이동 기록
  - 제품 분류 **변경 이력을 유지해야 하는 경우**


## 3. SCD Type III : 새로운 컬럼 추가(Add a New Column)
- 방법
    - **기존 행(Row)을 유지하면서 새로운 컬럼을 추가하여 변경 전 값을 저장** 한다.
    - **한 번만 변경 사항을 기록** 할 수 있다.(두 개 이상의 변경 이력 관리가 불가하다.)

- 예시
  
    ![Image](https://github.com/user-attachments/assets/b2d06089-2343-45f3-a1ff-1037d58bc3b7)


### 장점(Pros)
  -  **과거와 현재 데이터를 동시에 분석** 할 수 있다.
  -  **조인(JOIN) 없이도 변경 내역을 쉽게 확인** 할 수 있다.
    
### 단점(Cons)
  - **변경 이력이 2개 이상일 경우 관리가 어렵다.**
  - **장기적인 변경 이력을 유지할 수가 없다.**

### 사용 사례
  - **고객의 "이전 주소"와 "현재 주소"를 동시에 저장** (ex.브론즈->실버->골드)
  - **직원의 "이전 직급"과 "현재 직급"을 기록하는 경우**

## 4. SCD 현대적인 접근 방식(Modern Approach)
- 방법
    - **저장 비용이 저렴해짐에 따라 전체 차원 테이블을 스냅샷(Snapshot)** 으로 저장한다.
    - **데이터가 변경될 때마다 새로운 스냅샷을 저장** 하여 과거 보고서를 재현할 수 있다.(Type3와 차별점)

- 예시
  
    ![Image](https://github.com/user-attachments/assets/dbab425a-8126-45de-b763-35c0747e5410)


### 장점(Pros)
  -  **과거 데이터와 현재 데이터를 완벽하게 보존** 할 수 있다.
  -  **변경 이력 추적이 용이** 하다.
    
### 단점(Cons)
  - **저장 공간이 증가** 한다.
  - **스냅샷 관리 비용이 발생** 할 수 있다.

### 사용 사례
  - 데이터 웨어하우스 시스템에서 **모든 변경 이력을 유지하려 하는 경우**
  - **대용량 데이터 처리와 분석** 이 필요한 기업

-----
![Image](https://github.com/user-attachments/assets/50ffeed1-bca7-479a-9c59-931dc9b019e3)
- Type 1 : 데이터 변경 이력이 필요 없을 때 사용
- Type 2 : 과거 데이터와 변경 이력을 모두 유지해야 할 때 사용
- Type 3 : 변경 이력을 1~2번만 기록할 때 사용
- Modern Approach : 저장 비용이 낮아진 현대적 시스템에서 전체 변경 이력을 보관할 때 사용

=> 데이터 변경 이력 관리가 중요한 경우, Type II 또는 Modern Approach가 더 적합

<hr>

## Row Sotre vs Column Store : 데이터 저장 방식과 최적의 활용법
- 데이터베이스에서 데이터를 저장하는 방식에는 로우 스토어(Row Store)와 컬럼 스토어(Coulmn Store) 두 가지가 있다.
- 이 두 방식은 **데이터 저장 방식이 다르고** , **트랜잭션 처리(OLTP) 와 분석작업(OLAP)에 따라 최적화된 선택이 필요**하다.

## 1. Row Store (행 저장 방식)
- **행(Row) 단위** 로 데이터를 저장한다.
- **트랜잭션 중심(OLTP)** 데이터베이스에 적합하다.

- 1-1. 저장 방식
    - **각 행의 데이터가 하나의 블록** 에 함께 저장된다.
    - **새로운 데이터를 추가할 때, 새로운 행을 블록에 저장** 한다.

- 1-2. 예제
    - 질병 데이터 테이블(Flu Infection Data)
      
  ![Image](https://github.com/user-attachments/assets/c2fa3da2-20bb-4d42-88bc-a185268cd37a)
    
  ![Image](https://github.com/user-attachments/assets/f421e229-bbf1-46f6-a2ef-dabe0ffc6bc5)
  ![Image](https://github.com/user-attachments/assets/ca89c38c-ed9b-42bd-bdf7-ece7f077d771)

    - Block 1 : 2019, 0-17, 13.9%
    - Block 2 : 2019, 18-49, 22.5%
    - Block 3 : 2019, 50+, 63.7%
  
      - 위 예제에서는 2019년 시즌 18~49세 그룹의 데이터를 블록2에 배치했다. **이 형식은 트랜잭션 작업에 적합** 하다. 컴퓨터 시스템이 새로운 블록에 데이터를 쓰는 방식으로 테이블에 새로운 데이터를 추가할 수 있기 때문이다.

      - 하지만, 만약 우리가 **"2019년 시즌에, 모든 연령대의 평균 입원 비율이 얼마인가?"** 라는 질문에 관심이 있다면, 이 시스템은 **2019년 데이터가 포함된 각 블록을 모두 읽어야 한다.** 위 예시에서는 3개의 데이터 블록을 모두 읽어야 한다.
      
      - 이렇게 많은 행의 데이터 요약이 필요한 경우가 많기 때문에, 이런 저장 방법은 **분석 작업** 에는 상대적으로 느릴 수 있다.

- 1-3. 장점(Pros)
    - **새로운 행을 빠르게 추가** 할 수 있다.
    - **OLTP(트랜잭션) 작업에 최적화** 되어 있다.
    - 읽기/쓰기 작업이 빠르고 효율적이다.

- 1-4. 단점(Cons)
    - **분석(OLAP) 쿼리가 비효율적** 이다.
    - 특정 열(Coulmn)만 선택해서 조회할 때는 속도가 느리다.
    - **전체 데이터 블록을 읽어야 원하는 값에 접근이 가능** 하다.

- 1-5. 활용 사례
    - 온라인 쇼핑몰의 주문 처리 시스템
    - 은행의 실시간 거래 시스템
    - 실시간 데이터 업데이트가 필요한 어플리케이션

  
## 2. Column Store (열 저장 방식)
- **열(Column) 단위** 로 데이터를 저장한다.
- **분석 중심(OLAP)** 데이터베이스에 적합하다.

- 2-1. 저장 방식
    - **각 컬럼의 데이터가 하나의 블록** 에 함께 저장된다.
    - **읽기 작업(쿼리) 시 필요한 컬럼만 로드할 수 있어 성능이 향상** 된다.

- 2-2. 예제
    - 질병 데이터 테이블(Flu Infection Data)
      
  ![Image](https://github.com/user-attachments/assets/c2fa3da2-20bb-4d42-88bc-a185268cd37a)
    
  ![Image](https://github.com/user-attachments/assets/1a9d23d4-da11-4721-9030-9f6784fb2023)
  ![Image](https://github.com/user-attachments/assets/bdb1f8fc-ab19-4efe-ba26-dde1ab4a231f)

    - Block 1 : 2019, 2019, 2019, ...
    - Block 2 : 0-17,18-49,50+,...
    - Block 3 : 13.9%,22.5%,63.7%,...
  
      - 열 저장 방식은은 열의 데이터를 함께 저장한다.(ex. 연령대 열의 데이터는 block2 에만 저장된다.)
        
      - 만약 우리가 **"2019년 시즌에, 모든 연령대의 평균 입원 비율이 얼마인가?"** 라는 질문에 관심이 있다면, 이 시스템은 **시즌 블록과 함께 block2만 읽으면 된다.** 위 예시에서는 2개의 블록만 읽으면 된다.
        
      - 이처럼 **분석 작업** 에서는 row store 방식보다 column store 방식이 **더 빠르게 응답을 반환** 한다. 또, 모든 각 블록의 데이터가 동일한 유형이기 때문에, **데이터 압축이 용이해서 더 적은 공간** 에 동일한 데이터를 저장할 수 있다.
      
      - 다만, **새로운 것을 추가하는 데는 각 열의 블록을 읽고 편집해야 하기 때문에 상대적으로 더 오래 걸린다.**

- 2-3. 장점(Pros)
    - **OLAP(분석)작업에 최적화** 되어 있다.
    - 필요한 컬럼만 조회가 가능하다 --> **쿼리 속도가 향상** 된다.
    - **데이터 압축(Compression) 효율이 높다.** --> **저장 공간 절약** 이 된다.

- 2-4. 단점(Cons)
    - 새로운 데이터를 추가할 때는 속도가 느리다.
    - 행 단위로 데이터를 조회하는 경우에는 속도가 느리다.
    - **OLTP 시스템에서는 부적합** 하다.

- 2-5. 활용 사례
    - 데이터 웨어하우스(OLAP)에서 대규모 데이터 분석
    - 비즈니스 인텔리전스(BI) 시스템
    - 대량의 데이터 요약 및 통계 분석

## Row Store vs Column Store 비교
![Image](https://github.com/user-attachments/assets/78becfa2-f564-4b29-94a0-7e3801dcfd7b)

<hr>

## ETL vs ELT : 데이터 웨어하우스에서의 데이터 통합방법 비교
- 데이터 웨어하우스에서는 **다양한 소스에서 데이터를 가져와 정리하고 변환하는 과정이 필요** 하다.
- 이 과정에서 많이 사용되는 2가지 주요 기법이 ETL 과 ELT 기법이다.

## 1. ETL
- 데이터를 먼저 **추출(Extract)** 하고, **변환(Transform)** 한 후, 최종적으로 웨어하우스에 **적재(Load)**
- 데이터가 깨끗하게 정리된 후 데이터 웨어하우스로 로드된다.
- 변환 후 적재

- 추출(Extract) : 원본 데이터 소스에서 데이터를 가져온다.
- 변환(Transform) : 데이터 클리닝 및 변환을 수행한다. (정규화, 필터링, 비즈니스 규칙이 적용된다.)
- 적재(Load) : 정리된 데이터를 데이터 웨어하우스에 저장한다.

### ETL 의 장점(Pros)
1. **저장 공간이 절약**된다. : 변환된 데이터만 저장하므로 불필요한 데이터가 없다.
2. 보안 및 규제 준수에 용이하다. : **개인 식별 정보(PII)를 사전에 제거** 할 수 있다.
3. **정제된 데이터를 제공** 한다. : **데이터 품질을 보장하여 분석 신뢰도가 높다.**

### ETL 의 단점(Cons)
1. **원본 데이터 저장이 불가능** 하다. : 변환 과정에서 원본 데이터가 유지되지 않는다.
2. **Trasnform(변환)을 수행할 별도의 컴퓨터 시스템이 필요** 하다. : 데이터가 이동함에 따라 변환을 수행하기 위해 데이터웨어하우스 이외의 별도의 시스템이 필요하다.
3. 소스 시스템 부하가 발생할 가능성이 있다. : **대량 데이터 추출 시 성능 저하 문제가 발생할 수 있다.**
4. **처리 속도가 느릴 수 있다.** : 데이터 변환 과정이 복잡할 경우 시간소요가 증가한다.

### ETL 이 적합한 경우
    - 데이터 정제와 품질이 중요한 경우(ex. 금융, 헬스케어, 정부 기관)
    - 보안이 중요한 데이터(ex. 개인정보 포함 데이터)
    - 대량 데이터를 처리하기 위한 별도의 ETL 서버를 구축할 수 있는 경우(ex.온프레미스(사내 서버)환경에서 운영하는 경우)

## 2. ELT
- 데이터를 먼저 **추출(Extract)** 하고, 변환 없이 **바로 웨어하우스에 적재(Load)**
- **이후, 데이터 웨어하우스에서 변환(Transform)** 수행
- 적재 후 변환

- 추출(Extract) : 원본 데이터 소스에서 데이터를 가져온다.
- 적재(Load) : 원본 데이터를 변환 없이 그대로 데이터 웨어하우스에 저장한다.
- 변환(Transform) : 웨어하우스 내에서 데이터 변환을 수행한다.

### ELT 의 장점(Pros)
1. **빠른 데이터 적재** 가 가능하다. : 변환 없이 바로 로드하므로 신속한 저장이 가능하다.
2. **원본 데이터 유지** 가 가능하다 : **과거 데이터를 저장하고 재분석** 이 가능하다.
3. **변환(Transform)과정을 진행하는 별도의 컴퓨터 시스템이 필요없다.**
4. **대규모 데이터 처리가 가능** 하다. : **클라우드 환경에서 병렬 처리로 변환 속도를 향상시킨다.**

### ELT 의 단점(Cons)
1. **저장 공간이 증가** 한다. : 원본 데이터와 변환된 데이터가 함께 저장되기 때문이다.
2. **보안 이슈가 발생할 가능성** 이 존재한다. : 개인 정보(PII)가 웨어하우스에 저장될 수 있다.
3. **데이터 품질 문제가 발생할 가능성** 이 있다. : 변환을 나중에 수행하므로 정제되지 않은 데이터가 포함될 가능성이 있다.

### ELT 가 적합한 경우
    - 클라우드 기반 데이터 웨어하우스를 활용하는 경우(ex. Snowflake, BigQuery, Redshift)
    - 대용량 데이터 분석이 필요한 경우(ex.IoT, 로그 데이터, 스트리밍 데이터) 
    - 빠른 데이터 적재가 필요한 경우(ex. 실시간 분석, 대량 데이터 처리)

### 클라우드와 ELT 의 성장
- 최근 클라우드 데이터 웨어하우스의 발전으로 ELT 방식이 더욱 널리 사용되고 있다.

- 클라우드 환경의 장점
    - 무제한 저장 공간 제공 : 원본 데이터 저장이 가능하다.
    - 병렬 컴퓨팅 지원 : 빠른 데이터 변환이 가능하다.
    - 자동 확장(Auto Scailing) 가능 : 성능 최적화

## ETL vs ELT 비교
 ![Image](https://github.com/user-attachments/assets/8358638c-189e-453e-b3a2-a3b8b9099d91)

<hr>

## 데이터 정제(Data cleaning) : ETL 과 ELT 에서 필수적인 데이터 변환 과정
- 데이터 웨어하우스에서 **정확하고 일관된 데이터 분석을 수행하려면 데이터 정제(Data Cleaning)가 필수적** 이다.
- ETL(Extract, Transform, Load) 과 ELT(Extract, Load, Transform) 과정에서 **데이터 변환**이 수행되며, 이 과정에서 **불완전하거나 잘못된 데이터르르 수정하고 일관성을 유지하는 것이 핵심** 이다.
- ETL/ELT 에서 자주 사용되는 4가지 주요 데이터 정제 기법을 살펴보도록 하자.

## 1. 데이터 형식 정리(Data Format Cleaning)
- 데이터 소스마다 형식이 다를 수 있으므로, 일관된 형식으로 변환한다.
- 날짜(Date), 이름(Name), 주소(Address) 등의 형식을 통일한다.

- (ex) 택시 서비스 사용자 데이터 정리

    ![Image](https://github.com/user-attachments/assets/8bcf589c-c94f-4f5f-a6f8-be58734e9603)

    - 이름(Name) 데이터의 대소문자가 일관되지 않은 문제를 모든 이름을 소문자로 변환함으로써 해결
    - 날짜(Join_Date) 형식이 원하지 않은 형태로 되어 있는 문제를 `YYYY-MM-DD` 형태로 통일

## 2. 주소 파싱(Address Parsing)
- **주소를 구성 요소(시,도,우편번호 등)로 나누어 정리** 한다.
- **자동 주소 조회(Address Lookup) 및 유효성 검사** 가 가능해진다.

- (ex) 주소 데이터 정리

    ![Image](https://github.com/user-attachments/assets/cabb589a-04dc-43fb-8a3e-abd39158a8bf)

    - 주소를 개별 필드(Street, City, State, Zip) 으로 나눠 정리

## 3. 데이터 유효성 검사(Data validation)
- 데이터 값이 올바른 범위(Range)에 있는지 확인한다.
- 데이터 타입(Data Type)이 일관적인지 검사한다.

- (ex) 범위 검사(Range Check)

    ![Image](https://github.com/user-attachments/assets/429e8d29-e00b-4297-8a34-11c7e59618f3)

    - 나이(Age)가 300세 또는 -5세 같은 비정상적인 값이 있는 문제를 정상적인 나이 범위(ex. 0 < Age < 120) 를 벗어난 값은 오류를 처리함으로써 해결
    - 누락된 값은 조직 규칙에 따라 `NULL` 값 또는 `기본값(Default Value)` 로 처리
    
- (ex) 데이터 타입 검사(Data Type Check)

    ![Image](https://github.com/user-attachments/assets/d6cbeaeb-8472-4db8-bd61-695c6085949a)

    - 나이(Age)가 숫자 형식이어야 하지만, 일부 값들이 문자(String)으로 되어 있는 문제를 데이터 타입을 `FLOAT` 또는 `INTEGER` 로 변환함으로써 해결
    - 변환이 불가능한 값은 조직 규칙에 따라 `NULL` 값 또는 `기본값(Default Value)` 로 처리

## 4. 중복 데이터 제거(Duplicate Row Elimination)
- 중복된 데이터가 있는지 확인하고 제거하는 과정

- (ex) 병원 의사 데이터 중복 제거

    ![Image](https://github.com/user-attachments/assets/623c4852-0a1d-4181-8434-f0fe2133a435)

    - `DoctorID 275` 가 중복으로 저장되는 문제를 `DoctorID` 기준으로 중복된 데이터를 제거하고 추가함으로써 해결

## 데이터 거버넌스(Data Governance)와 데이터 품질 유지
- 데이터 거버넌스(Data Governance)
    
    - 데이터를 관리하고 품질을 유지하기 위한 **정책, 규칙, 프로세스를 설정** 한다.
    - **데이터 표준화 및 모니터링 시스템을 도입** 하면, 정제 과정에서 오류를 줄일 수 있다.

- 데이터 정제 프로세스를 **최소화** 하는 방법

  1) 데이터 **입력 단계** 에서 검증 로직을 적용한다.
  2) **데이터 품질 기준을 정의** 하고 **자동 모니터링** 을 한다.
  3) **정기적인 데이터 감사(Audit)** 및 오류를 수정한다.

- 강력한 데이터 거버넌스를 구축하면, ETL/ELT 과정에서 불필요한 정제 작업을 줄일 수 있다.

<hr>

## 온프레미스 vs 클라우드 데이터 웨어하우스 
- 데이터 웨어하우스를 구축할 때, 기업은 **온프레미스(On-Premise) 방식** 과 **클라우드(Cloud) 방식** 중 하나를 선택해야 한다.
- 각 방식은 **비용, 관리, 보안, 확장성 등의 측면에서 차이** 가 있으며, **하이브리드(Hybrid) 접근법도 존재** 한다.

## 1. 온프레미스(On-premise) 데이터 웨어하우스
- `온프레미스(On-Premise)` 란 기업이 **물리적인 서버와 하드웨어를 직접 구매하여 자체적으로 데이터 웨어하우스를 구축** 하는 방식이다.
- 데이터 센터를 보유한 기업이 **직접 하드웨어와 소프트웨어를 관리하고 운영** 한다.

### 특징
- 기업이 **하드웨어 및 소프트웨어를 직접 설치 및 유지보수** 한다.
- **데이터 거버넌스 및 보안** 을 철저히 관리할 수 있다.
- **네트워크 성능 최적화가 가능** 하다.(로컬 네트워크를 활용하여 빠른 데이터 처리가 가능하다.)

### 장점(Pros)

- `완전한 제어(Full Control)`
    - 데이터 및 시스템 설정을 **100% 직접 관리** 할 수 있다.
    - 데이터 접근 권한과 보안 정책을 **맞춤으로 설정** 할 수 있다.
    - 금융, 의료, 공공 기관처럼 **강력한 보안 규제가 필요한 조직에 적합** 하다.

- `빠른 로컬 네트워크 속도`
    - 기업 내부에서 운영되므로 **데이터 전송 속도가 빠르다.**
    - 클라우드처럼 **인터넷 대역폭 문제를 걱정할 필요가 없다.**

- `맞춤형 튜닝(Custom Optimization)`
    - 기업이 필요에 맞게 **데이터 웨어하우스 성능을 최적화** 할 수 있다.

### 단점(Cons)

- `초기 비용(Initial Cost) 부담`
    - 서버, 네트워크 장비, 스토리지 등을 직접 구매해야 하므로 초기 비용이 크다.
    - 하드웨어 교체 및 업그레이드 비용도 지속적으로 발생한다.

- `운영 및 유지보수 부담`
    - 시스템 유지보수를 위한 **전문 IT 인력 및 관리 비용이 필요** 하다.
    - **보안 패치 및 업데이트를 수동으로 관리** 해야 한다.

- `확장성 부족(Scalability Issue)`
    - 데이터 용량이 증가하면 새로운 서버를 추가해야 한다.
    - 빠르게 확장이 어려우며, 사용하지도 않는 자원도 유지 비용이 발생한다.

## 2. 클라우드(Cloud) 데이터 웨어하우스
- AWS, Azure, Cloud 등의 클라우드 제공업체가 하드웨어 및 소프트웨어를 관리하는 Saas 또는 **서비스형 데이터 웨어하우스(DaaS, Data Warehouse as a Service)** 이다.
- 기업은 **필요한 만큼의 스토리지와 컴퓨팅 자원을 사용하고 비용을 지불** 한다.

### 대표적인 클라우드 데이터 웨어하우스 솔루션
- Amazon Redshift
- Google Bigquery
- Microsoft Azure Synapse
- Snowflake

### 장점(Pros)

- `비용 절감 및 사용량 기반 결제(Pay-as-You-Go)`
    - **초기 하드웨어 구매 비용 없이 구독형 모델을 사용** 한다.
    - 사용한 만큼 비용을 지불하므로 **운영 비용을 절감** 할 수 있다.

- `확장성(Scalability) 우수`
    - 기업의 데이터가 증가해도 **즉시 확장 가능(Auto Scailing)** 하다.
    - 컴퓨팅 성능도 **필요할 때만 증설하여 비용 절감이 가능**하다.

- `유지보수 부담 감소(Managed Service 제공)`
    - **클라우드 제공업체가 보안 패치, 업데이트, 서버 유지보수를 담당** 한다.
    - **기업은 데이터 분석 및 비즈니스에 집중** 할 수 있다.

- `글로벌 데이터 접근 가능`
    - 여러 지역에서 쉽게 데이터 접근이 가능하다.
    - **멀티 region 백업 및 장애 복구 기능을 제공** 한다.

### 단점(Cons)

- `데이터 통제권(Control) 부족`
    - **클라우드 제공업체가 인프라를 관리** 하기 때문에, 기업이 하드웨어 및 네트워크 성능을 직접 튜닝할 수 없다.
    - 금융 및 의료 산업처럼 **엄격한 보안 정책이 필요한 경우, 제한적일 수 있다.**

- `비용 변동 가능성(Unexpected Costs)`
    - 사용량이 급증하면 예상치 못한 비용이 발생할 수 있다.
    - **쿼리 실행량이 많아질 경우, 데이터 처리 비용이 급격히 증가할 가능성** 이 있다.

- `네트워크 대역폭 의존`
    - 인터넷을 통해 데이터가 전송되므로, **네트워크 속도에 따라 성능이 좌우** 된다.
    - 대량 데이터 이동 시 **클라우드 전송 비용(egress cost)이 발생** 할 수 있다.

## 3. 하이브리드(Hybrid) 접근법 : 온프레미스 +  클라우드 혼합 운영
- 하이브리드 데이터 웨어하우스는 **일부 데이터를 온프레미스에서 관리하고, 다른 일부는 클라우드에서 운영하는 방식** 이다.

### 하이브리드 방식을 선택하는 이유

  - 보안 및 규제 준수를 위한 온프레미스 운영
  - 비용 절감을 위해 비즈니스 분석용 데이터는 클라우드에서 운영
  - 백업 및 재해 복구(Disaster Recovery) 목적을로 클라우드를 활용

## 온프레미스 vs 클라우드 vs 하이브리드
![Image](https://github.com/user-attachments/assets/3dfef124-17bf-4b5c-8992-532706e5fb03)

<hr>

## 스타트업을 위한 데이터 웨어하우스 설계 예제
- 데이터 웨어하우스를 구축할 때, 기업의 비즈니스 목표와 기술적 요구사항을 고려하는 것이 중요하다.
- 최종적으로 **사진 공유 플랫폼을 운영하는 스타트업을 위한 데이터 웨어하우스 설계 과정** 을 예제로 살펴보겠다.

## 1. 프로젝트 개요

- 배경
    - 사진 공유 플랫폼에서 사진작가들이 사진을 판매하는 서비스를 운영
    - **데이터 웨어하우스를 구축하여 고객 구매 행동을 분석** 하는 것이 목표이다.

- 주요 요구사항
    - 비즈니스 의사결정을 위한 **빠른 데이터 분석**
    - **고객 데이터를 활용하여 매출 증가 전략을 수립**
    - **확장 가능** 하고 **비용 효율적인 클라우드 기반 솔루션** 선택

## 2. 데이터 웨어하우스 설계 접근법 : 바텀업(Bottom-up) 방식 선택
- 왜 바텀업 접근법을 선택했나?
    - 바텀업(Bottom-up) 접근법은 빠른 결과 도출이 가능하다.
    - 스타트업은 **빠른 성과(Quick Wins)** 가 중요하다.
    - 탑다운(Top-down) 접근법은 상대적으로 시간이 오래 걸리므로 부적합하다.
    - 먼저 **핵심 비즈니스 요구사항(ex.판매 데이터 분석)** 을 충족하는 **작은 데이터 마트를 구축** 한 후, 확장이 가능하다.

## 3. Kimball 의 4단계 모델링 적용
- 1단계 : 조직 프로세스 선택(Select the Organizational Process)
    
    - 목표
        - 매출 분석을 최우선 과제로 선정
        - 고객 행동을 이해하고 고객별 구매 패턴을 분석하여 맞춤형 마케팅 전략을 수립

    - 분석할 주요 질문
        - 어떤 고객이 사진을 가장 많이 구매했는가?
        - 어떤 유형의 사진이 가장 인기 있는가?
        - 고객의 지역별 구매 경향은 어떻게 다른가?

- 2단계 : 데이터 그레인(Granularity) 정의
    
    - 그레인(Grain) 결정
        - **각 고객의 개별 구매를 한 행(Row)** 으로 저장
        - **가장 세부적인 수준에서 데이터 추적** 이 가능

    - 팩트 테이블(Fact Table) 기본 단위
        - **고객이 특정 사진을 구매한 기록을 개별 행** 으로 저장

- 3단계 : 차원(Dimension) 식별
    
    - 어떤 차원 데이터를 추출할 것인가?
        - **고객 정보(Customer)** : 위치, 가입 날짜, 결제 방법
        - **사진 정보(Photo)** : 사진 유형, 사진 작가
        - **날짜 정보(Date)** : 구매 날짜

    - 차원 테이블 예시(ex.고객 정보 차원테이블)

      <img width="712" alt="Image" src="https://github.com/user-attachments/assets/527fa8fe-6d41-47aa-9a8d-54f5a2600ce3" />

- 4단계 : 팩트(Facts) 식별

    - 팩트 테이블(Fact Table)에서 추적할 **주요 수치 데이터(Facts)**
    
    - 고객 참여도를 분석하기 위한 주요 지표
        - 고객이 사진을 감상한 시간(Viewing Time)
        - 고객이 구매한 사진(Photo ID)
        - 사진의 가격(Purchase Amount)

    - 팩트 테이블 예시

      <img width="701" alt="Image" src="https://github.com/user-attachments/assets/ca1e1454-e297-42cc-89e9-1ae37b264973" />
      
          
## 4. 데이터 웨어하우스 모델링 : 스타 스키마(Star Schema) 적용
- **스타 스키마 구성**
  
    ![Image](https://github.com/user-attachments/assets/7f81863a-aed0-45dd-9a6d-1862d1e4891a)
    
    - 중앙의 **팩트 테이블(Fact Table) 과 주변의 차원 테이블(Dimension Tables) 을 연결** 한다.
    - 빠른 분석이 가능하며, SQL 쿼리가 단순해진다.

## 5. 온프레미스 vs 클라우드 구현 결정

- 스타트업의 상황을 고려해보자.
  
    - 초기 인프라 비용 절감이 필요하다.
    - 작은 팀이 운영하므로 유지보수 부담이 최소화된다.
    - 확장성이 중요한 요소이다.

- 결정 : **클라우드 데이터 웨어하우스 선택!**
    - AWS Redshift, Google BigQuery, Snowflake 등의 클라우드 솔루션을 활용한다.
    - 초기 비용 없이 필요할 때만 리소스를 사용하여 비용을 절감할 수 있다.

## 6. ETL vs ELT 방식 결정

- 스타트업의 데이터 전략을 살펴보자.

    - 데이터를 최대한 많이 저장하여 향후 분석에 활용하고 싶어한다.
    - 클라우드 기반이므로 **확장성(Scalability)이 중요** 하다.
    - ELT 방식이 데이터를 먼저 저장한 후 변환하므로 더 유연하다.

 - 결정 : **ELT 방식 선택!**
    
    - 데이터를 원본 그대로 웨어하우스에 로드한 후 변환을 진행한다.
    - 향후 새로운 분석 요구사항이 생기더라도 유연하게 대응이 가능하다.

## 데이터 웨어하우스 구축 프로세스 최종 요약

<img width="516" alt="Image" src="https://github.com/user-attachments/assets/06c37c36-6e6d-4f0c-8e85-1c51dcf570c5" />

  

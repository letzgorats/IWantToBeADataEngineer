## 🐍 Python으로 시작하는 API 입문 – requests 라이브러리로 첫 API 요청하기
API는 현대 소프트웨어 개발에서 데이터를 주고받는 핵심 도구입니다. 
이번 글에서는 Python requests 패키지를 사용해 웹 API와 상호작용하는 기초부터, URL 구조·HTTP 메서드·헤더와 상태 코드까지 다뤄보겠습니다.

### 1. API란 무엇인가?
`API(Application Programming Interface)`는 서로 다른 시스템 간의 소통 규칙과 기능을 정의한 인터페이스입니다.
우리가 이메일 앱에서 "전송" 버튼을 누르면, 사실은 앱이 메일 서버의 API를 호출해 이메일 발송 요청을 보내는 것이죠.

- UI: 사용자가 직접 보는 화면 (예: 이메일 앱 인터페이스)
- API: 프로그램끼리 데이터를 주고받는 통로 (예: 이메일 전송 명령)

### 2. Web API 의 개념
Web API는 인터넷을 통해 HTTP 프로토콜로 통신하는 API 입니다.
- `클라이언트(Client)` : 요청을 보내는 쪽(브라우저, 앱, Python 스크립트)
- `서버(Server)` : 요청을 처리하고 응답을 반환하는 쪽

### 3. Web API의 대표 유형

| 유형          | 특징                                 | 활용 예시                   |
| ----------- | ---------------------------------- | ----------------------- |
| **SOAP**    | XML 기반, 엄격한 규격, 기업용 대규모 시스템에서 사용   | 금융·정부 시스템               |
| **REST**    | URL·HTTP 메서드 기반, 단순하고 확장성 높음       | 대부분의 웹 서비스 API          |
| **GraphQL** | 클라이언트가 원하는 데이터만 요청 가능, 네트워크 효율성 높음 | GitHub API, Shopify API |

> 이번 글에서는 **REST API** 를 중심으로 다룹니다.

### 4. Python에서 API 요청하기 – urllib vs requests

#### 📌 urllib
Python 기본 내장 모듈이지만, 응답 읽기·디코딩 등 절차가 다소 복잡합니다.
```python
from urllib.request import urlopen

response = urlopen("https://api.example.com/albums")
data = response.read().decode("utf-8")
print(data)
```

#### 📌 requests
더 간결하고 직관적이며, 많은 기능이 기본 제공됩니다.
```python
import requests

response = requests.get("https://api.example.com/albums")
print(response.text)
```

### 5.  URL 구조와 Query Parameter
URL은 API에서 **리소스의 위치** 와 **추가 옵션** 을 지정하는 주소입니다.

#### URL 5대 구성요소
1. `Protocol` : `http/https`
2. `Domain` : `api.example.com`
3. `Port` : `:80`,`:443`,(생략 시 기본값 사용)
4. `Path` : `/albums`
5. `Query String` : `?artist=Queen&year=1980`

#### requests 로 Query Parameter 추가
```python
params = {"artist": "Queen", "year": 1980}
response = requests.get("https://api.example.com/albums", params=params)
```

### 6. 주요 HTTP 메서드(Verbs)

<img width="1108" height="274" alt="image" src="https://github.com/user-attachments/assets/52a3b391-8643-46c1-8ea8-a7a4a76ee33b" />

| 메서드    | 설명        | 예시 상황      |
| ------ | --------- | ---------- |
| GET    | 리소스 조회    | 앨범 목록 가져오기 |
| POST   | 리소스 생성    | 새 앨범 추가    |
| PUT    | 리소스 전체 수정 | 앨범 정보 변경   |
| DELETE | 리소스 삭제    | 앨범 제거      |

```python
# POST 예시
data = {"title": "New Album", "artist": "Queen"}
requests.post("https://api.example.com/albums", data=data)

```

### 7. Request message VS Response message

#### 1) start line
<img width="1013" height="400" alt="image" src="https://github.com/user-attachments/assets/7410d2c0-27b6-4766-929a-e6f83198a462" />

> `클라이언트-서버` 의 `요청-응답` 메시지 구조가 매우 유사하며 둘 다 세 부분으로 나눌 수 있습니다. 그 중 첫 부분이 `start-line` 입니다.

> 요청메시지의 요청라인에는 `GET`,`POST` 와 같은 요청 유형과 메시지가 전달되어야 하는 경로가 포함됩니다.

> 응답메시지의 시작라인은 `상태줄`이라고도 합니다. 3자리 숫자 상태 코드와 상태 메시지가 포함되어 있죠.

##### 📌 Status Code 주요 예시

<img width="1030" height="301" alt="image" src="https://github.com/user-attachments/assets/eea7d993-3b39-4ba1-ab6a-088cabac8c62" />

> `400`번대는 클라이언트 오류/ `500`번대는 서버 오류

| 코드  | 의미                            |
| --- | ----------------------------- |
| 200 | OK – 요청 성공                    |
| 404 | Not Found – 리소스 없음            |
| 500 | Internal Server Error – 서버 오류 |

```python
response = requests.get("https://api.example.com/albums")
print(response.status_code)    # 200 이라면,

response.status_code == 200    # True
```
> `response.status_code` 를 통해 응답 상태코드값을 알 수 있습니다.

##### 📌 Status Code with requests
```python
import requests

print(requests.codes.ok)         # 200
print(requests.codes.not_found)  # 404

# 상태 코드 비교 예시
response = requests.get("https://api.github.com/404")
print(response.status_code == requests.codes.not_found)  # True
```
> `response.status_code` 를 통해 응답 상태코드값을 알 수 있습니다. 

> `requests` 모듈 안에는 `codes` 라는 객체가 있습니다.
> `requests.codes`쉬운 조회 객체가 내장되어 있어서, 상태 코드의 모든 숫자를 암기할 필요는 없습니다.

> `requests.codes.___`를 통해 코드 상수가 매핑되기 때문에 응답 상태 코드와 비교시 유용합니다. 

#### 2) headers
<img width="1024" height="412" alt="image" src="https://github.com/user-attachments/assets/2e3572ac-effc-4747-a8c8-61ee9bf319a5" />

> 각 헤더에는 `전송`되거나 `수신되는 메시지` 또는 `데이터를 설명하는 정보`가 포함되어 있습니다. 전송하는 콘텐츠의 유형이나, 요청한 리소스가 마지막으로 수정된 날짜 등입니다.

> 대소문자를 구분하지 않는 키로 시작하고, 그 뒤에 콜론과 해당 헤더의 값이 옵니다.(`key-value`)

> 효과적으로 통신하기 위해 클라이언트와 서버는 메시지를 사용합니다. 헤더에서는 정보를 교환하는 데 사용할 언어에 대해 합의합니다. 이것을 '콘텐츠 협상' 이라고 합니다.
> 예를 들어, `클라이언트`는 `accept` 헤더를 전송하여 서버에 JSON 형식의 응답을 수락할 수 있음을 알립니다.
> `서버`가 응답할 때는 클라이언트에게 응답 형식을 알리기 위해 `content-type` 헤더를 포함합니다.

##### 📌 Adding the accept header will tell the API we want to receive a JSON formatted response!

<img width="982" height="532" alt="image" src="https://github.com/user-attachments/assets/6046c197-883d-4b40-ba0b-ef098053c980" />


##### 📌 Headers 활용
파이썬 requests 패키지를 활용하면 헤더를 추가하고 읽을 수 있습니다. `requests.get()` 이나 `requests.post()` 등 내부에 `headers` 매개변수를 사용하면 **원하는 만큼의 헤더를 요청에 추가**할 수 있습니다.

```python

headers = {"Accept": "application/json"}
response = requests.get("https://api.example.com/albums", headers=headers)

# 대소문자 구분없는 키(content-type)를 활용해 응답객체 기준에서는 content type 이므로 headers의 content-type 뽑는 2가지 방법
print(response.headers["Content-Type"])    # 'application/json'
print(response.headers.get("content-Type")    # 'application/json'
```

### 8. 실무 팁

- Postman이나 cURL로 먼저 API 응답을 확인하고 Python 코드로 옮기면 디버깅이 쉬워집니다.
- API 호출 시 인증 토큰이 필요한 경우 headers에 "Authorization": "Bearer <token>"를 추가합니다.
- REST API 문서를 읽을 때는 `요청 URL`, `메서드`, `파라미터`, `응답 예시` 4가지를 꼭 체크하세요.

### 마무리
이번 글에서는 API의 기본 개념부터 Python `requests` 로 `GET`, `POST` 요청을 보내고, URL 구성-HTTP 메서드, 헤더 상태 코드까지 살펴봤습니다.
다음 단계에서는 인증이 필요한 API 와 JSON 데이터 처리를 다뤄보겠습니다.

<hr>

## 🔐 Python API 활용 심화 – 인증, JSON, 에러 처리까지 완벽 가이드
1과에서 우리는 requests 라이브러리를 사용해 API 요청의 기본기를 다졌습니다. 
이번 글에서는 한 걸음 더 나아가 **인증(Authentication)** 을 통한 보안 강화, **구조화 데이터(JSON)** 처리, 그리고 **에러 대응(Error Handling)** 방법까지 다뤄봅니다.
실무에서 API를 안정적이고 안전하게 사용하기 위해 꼭 알아야 할 핵심 기술들을 예제와 함께 익혀봅시다.

### 1. API 인증(Authentication)

#### 1) 왜 필요한가?
- API 에는 민감한 데이터가 포함될 수 있으므로, 서버는 사용자의 신원을 확인해야 합니다.
- 인증이 없으면 보통 401 Unauthorized 오류가 발생합니다.

#### 2) 주요 인증 방식
   
| 방식                  | 특징                             | 보안 수준 |
| ------------------- | ------------------------------ | ----- |
| **Basic Auth**      | username\:password를 Base64 인코딩 | 낮음    |
| **API Key / Token** | URL 파라미터나 헤더에 키 전달             | 중간    |
| **JWT**             | 만료 시간·추가 정보 포함, 토큰 기반          | 높음    |
| **OAuth 2.0**       | 권한 위임, 세밀한 접근 제어               | 매우 높음 |

##### 📌 Rank the API authentication methods from most secure (top) to least secure (bottom) by dragging them to the right position.

<img width="721" height="314" alt="image" src="https://github.com/user-attachments/assets/4a01ec89-cbd6-4a77-b584-b76ec76013c3" />

#### 3) requests 에서 구현 예시

#### 📌 Basic Authentication with requests & API key authentication with requests

```python
# Basic Auth
requests.get(url, auth=('user', 'pass'))

# API Key - 헤더 방식
headers = {'Authorization': 'Bearer YOUR_API_KEY'}
requests.get(url, headers=headers)

# API Key - 쿼리 파라미터 방식
params = {'access_token': 'YOUR_API_KEY'}
requests.get(url, params=params)
```

##### ✅ 1. Basic Authentication with requests - `auth`

```python
# Create the authentication tuple with the correct values for basic authentication
authentication = ('john@doe.com','Warp_ExtrapolationsForfeited2')

# Use the correct function argument to pass the authentication tuple to the API
response = requests.get('http://localhost:3000/albums', auth=authentication)

if(response.status_code == 200):
    print("Success!")
elif(response.status_code == 401):
    print('Authentication failed')
else:
    print('Another error occurred')
```
> `auth` 인자를 사용하는 방법

> `auth` 인자에 (user,password) 튜플을 전달하면 됩니다.

##### ✅ 2. API key authentication with requests - `headers`, `params`

**1) `headers = {'Authorization' : Bearer APIKEY}`**

```python
# Create a headers dictionary containing and set the API key using the correct key and value 
headers = {'Authorization': 'Bearer 8apDFHaNJMxy8Kt818aa6b4a0ed0514b5d3'}

# Add the headers dictionary to the requests.get() call using the correct function argument
response = requests.get('http://localhost:3000/albums', headers=headers)

if(response.status_code == 200):
    print("Success!")
elif(response.status_code == 401):
    print('Authentication failed')
else:
    print('Another error occurred')
```
> `headers` 인자를 사용하는 방법

> headers = {`Authorization` : `Bearer APIKEY`} 를 활용하면 됩니다. 


**2) `params = {'access_token' : TOKENKEY}`**

```python
# Create a dictionary containing the API key using the correct key-value combination
params = {'access_token': '8apDFHaNJMxy8Kt818aa6b4a0ed0514b5d3'}

# Add the dictionary to the requests.get() call using the correct function argument
response = requests.get('http://localhost:3000/albums', params=params)

if(response.status_code == 200):
    print("Success!")
elif(response.status_code == 401):
    print('Authentication failed')
else:
    print('Another error occurred')
```
> `params` 인자를 사용하는 방법

> params = {`access_token`: `TOKEN_KEY`} 를 활용하면 됩니다.


### 2. 구조화 데이터(JSON) 다루기

#### 1) JSON 의 장점
- 속성, 리스트 등 복잡한 데이터를 표현 할 수 있다.
- 경량 포맷이고, 언어 독립적이며 가독성이 좋다.(human-readable)

#### 2) Python ↔ JSON 변환 : `dumps()`, `loads()`
```python
import json

# Python → JSON
json_str = json.dumps({'title': 'Album', 'artist': 'Queen'})

# JSON → Python
data = json.loads(json_str)
```

#### 3) requests로 JSON 처리
```python
# JSON 응답 받기
headers = {'accept': 'application/json'}
response = requests.get(url, headers=headers)
data = response.json()  # Python dict 변환

# JSON 데이터 전송
playlist = {"title": "My Playlist", "songs": ["Song1", "Song2"]}
response = requests.post(url, json=playlist)  # 자동 인코딩 & 자동 Content-Type 설정
```

### 3. 에러 처리(Error Handling)

#### 1) 상태 코드 범위
- `4xx` : 클라이언트 오류 → 요청이 잘못됨
- `5xx` : 서버 오류 → 서버 내부 문제

#### 2) 주요 코드

| 코드  | 의미     | 대처          |
| --- | ------ | ----------- |
| 401 | 인증 필요  | 인증 정보 추가    |
| 404 | 리소스 없음 | URL/파라미터 확인 |
| 429 | 요청 과다  | 요청 간격 늘리기   |
| 500 | 서버 오류  | 재시도 로직 추가   |

#### 3) 예외 처리 패턴

```python
# Import the correct exception class
from requests.exceptions import HTTPError,ConnectionError

url ="http://localhost:3000/albums/"
try: 
    r = requests.get(url) 
    r.raise_for_status() # Enable raising errors for all error status_codes
    print(r.status_code)

#intercept the connection error
except ConnectionError as conn_err:
    print(f'네트워크 연결 오류 발생 : {conn_err}')

# Intercept the http error 
except HTTPError as http_err:
    print(f'HTTP 오류 발생: {http_err}')
```

### 4) 실무 팁
- API KEY 는 `.env` 또는 환경 변수로 관리(하드코딩 금지)
- API 호출 로그에 **응답 속도, 상태 코드, 응답 형식** 기록
- 429(Too Many Requests) 방지를 위해 `time.sleep()` 활용

    ```python
    while True:
    params = {'page': page_number, 'per_page': 500}
    response = requests.get('http://localhost:3000/tracks', params=params, headers=headers)
    response.raise_for_status()
    response_data = response.json()
    
    print(f'Fetching tracks page {page_number}')

    if len(response_data['results']) == 0:
        break

    for track in response_data['results']:
        if(track['Length'] > longestTrackLength):
            longestTrackLength = track['Length']
            longestTrackTitle = track['Name']

    page_number = page_number + 1
    
    # To avoid 429 Client Error indicating we are sending too many requests to the server in a short amount of time.
    time.sleep(3)

    print('The longest track in my music library is: ' + longestTrackTitle)
    ```

### 마무리
이번 글에서는 API를 안전하고 안정적으로 사용하는 세 가지 핵심 요소를 배웠습니다.
1) **인증(Authentication)** 으로 보안을 강화하고,
2) **구조화 데이터(JSON)** 로 복잡한 정보를 주고받았으며,
3) **에러처리(Error Handling)** 로 예외 상황을 안전하게 처리할 수 있게 되었습니다.

이제, 단순 요청을 넘어서 **실무 수준의 API 통합**을 구현할 준비를 갖춘 것이죠!🚀

<hr>














































